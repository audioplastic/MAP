<pre class="code">
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',1);">  1</a></span><span class="line"><span class="comment">%#eml</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',2);">  2</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T4U3">frameBufferL</span>, <span class="var type1" id="S3T4U4">frameBufferR</span>, <span class="var type1" id="S4T5U5">filterStatesL</span>, <span class="var type1" id="S5T5U6">filterStatesR</span>,  <span class="var type1" id="S6T4U7">ARampL</span>, <span class="var type1" id="S7T4U8">ARampR</span>, <span class="var type1" id="S8T3U9">MOCend</span>, <span class="var type1" id="S9T3U10">peakIPL</span>, <span class="var type1" id="S10T3U11">peakOPL</span>, <span class="var type1" id="S11T3U12">rmsIPL</span>, <span class="var type1" id="S12T3U13">rmsOPL</span>, <span class="var type1" id="S13T3U14">peakIPR</span>, <span class="var type1" id="S14T3U15">peakOPR</span>, <span class="var type1" id="S15T3U16">rmsIPR</span>, <span class="var type1" id="S16T3U17">rmsOPR</span>, <span class="var type1" id="S17T2U18">MOCcontrol</span>, <span class="var type1" id="S18T1U19">FILO_iL</span>, <span class="var type1" id="S19T1U20">FILO_iR</span>, <span class="var type1" id="S20T1U21">FILO_oL</span>, <span class="var type1" id="S21T1U22">FILO_oR</span> ] =<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',3);">  3</a></span><span class="line">    EssexAidProcessVFrameFFT( <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',4);">  4</a></span><span class="line">    <span class="mxinfo" id="T4:U21"><span class="mxinfo" id="T4:U22"><span class="var type1" id="S2T4U25">frameBufferL</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',5);">  5</a></span><span class="line">    <span class="mxinfo" id="T4:U24"><span class="mxinfo" id="T4:U25"><span class="var type1" id="S3T4U26">frameBufferR</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',6);">  6</a></span><span class="line">    <span class="mxinfo" id="T5:U27"><span class="mxinfo" id="T5:U28"><span class="var type1" id="S4T5U27">filterStatesL</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',7);">  7</a></span><span class="line">    <span class="mxinfo" id="T5:U30"><span class="mxinfo" id="T5:U31"><span class="var type1" id="S5T5U28">filterStatesR</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',8);">  8</a></span><span class="line">    <span class="var type1" id="S22T7U29">filterCoeffs</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',9);">  9</a></span><span class="line">    <span class="var type1" id="S23T31U30">numChannels</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',10);"> 10</a></span><span class="line">    <span class="var type1" id="S24T6U31">numSamples</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',11);"> 11</a></span><span class="line">    <span class="mxinfo" id="T4:U36"><span class="mxinfo" id="T4:U37"><span class="var type1" id="S6T4U32">ARampL</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',12);"> 12</a></span><span class="line">    <span class="mxinfo" id="T4:U39"><span class="mxinfo" id="T4:U40"><span class="var type1" id="S7T4U33">ARampR</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',13);"> 13</a></span><span class="line">    <span class="var type1" id="S25T6U34">ARthresholdPa</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',14);"> 14</a></span><span class="line">    <span class="var type1" id="S26T37U35">DRNLb</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',15);"> 15</a></span><span class="line">    <span class="var type1" id="S27T37U36">DRNLc</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',16);"> 16</a></span><span class="line">    <span class="var type1" id="S28T37U37">MOCthreshold_dBOP</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',17);"> 17</a></span><span class="line">    <span class="var type1" id="S29T6U38">MOCfactor</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',18);"> 18</a></span><span class="line">    <span class="mxinfo" id="T3:U47"><span class="mxinfo" id="T3:U48"><span class="var type1" id="S9T3U39">peakIPL</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',19);"> 19</a></span><span class="line">    <span class="mxinfo" id="T3:U50"><span class="mxinfo" id="T3:U51"><span class="var type1" id="S10T3U40">peakOPL</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',20);"> 20</a></span><span class="line">    <span class="mxinfo" id="T3:U53"><span class="mxinfo" id="T3:U54"><span class="var type1" id="S11T3U41">rmsIPL</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',21);"> 21</a></span><span class="line">    <span class="mxinfo" id="T3:U56"><span class="mxinfo" id="T3:U57"><span class="var type1" id="S12T3U42">rmsOPL</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',22);"> 22</a></span><span class="line">    <span class="mxinfo" id="T3:U59"><span class="mxinfo" id="T3:U60"><span class="var type1" id="S13T3U43">peakIPR</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',23);"> 23</a></span><span class="line">    <span class="mxinfo" id="T3:U62"><span class="mxinfo" id="T3:U63"><span class="var type1" id="S14T3U44">peakOPR</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',24);"> 24</a></span><span class="line">    <span class="mxinfo" id="T3:U65"><span class="mxinfo" id="T3:U66"><span class="var type1" id="S15T3U45">rmsIPR</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',25);"> 25</a></span><span class="line">    <span class="mxinfo" id="T3:U68"><span class="mxinfo" id="T3:U69"><span class="var type1" id="S16T3U46">rmsOPR</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',26);"> 26</a></span><span class="line">    <span class="mxinfo" id="T3:U71"><span class="mxinfo" id="T3:U72"><span class="var type1" id="S8T3U47">MOCend</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',27);"> 27</a></span><span class="line">    <span class="mxinfo" id="T2:U74"><span class="mxinfo" id="T2:U75"><span class="var type1" id="S17T2U48">MOCcontrol</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',28);"> 28</a></span><span class="line">    <span class="var type1" id="S30T37U49">mainGain</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',29);"> 29</a></span><span class="line">    <span class="var type1" id="S31T6U50">nfft</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',30);"> 30</a></span><span class="line">    <span class="var type1" id="S32T32U51">H</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',31);"> 31</a></span><span class="line">    <span class="mxinfo" id="T1:U80"><span class="mxinfo" id="T1:U81"><span class="var type1" id="S18T1U52">FILO_iL</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',32);"> 32</a></span><span class="line">    <span class="mxinfo" id="T1:U83"><span class="mxinfo" id="T1:U84"><span class="var type1" id="S19T1U53">FILO_iR</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',33);"> 33</a></span><span class="line">    <span class="mxinfo" id="T1:U86"><span class="mxinfo" id="T1:U87"><span class="var type1" id="S20T1U54">FILO_oL</span></span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',34);"> 34</a></span><span class="line">    <span class="mxinfo" id="T1:U89"><span class="mxinfo" id="T1:U90"><span class="var type1" id="S21T1U55">FILO_oR</span></span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',35);"> 35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',36);"> 36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',37);"> 37</a></span><span class="line"><span class="comment">% numSamples = 512;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',38);"> 38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',39);"> 39</a></span><span class="line"><span class="comment">%ESSEXAIDPROCESSFRAME Essex aid algorithm in frame processing mode</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',40);"> 40</a></span><span class="line"><span class="comment">%   This code will look a bit odd to most Matlab programmers. This is</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',41);"> 41</a></span><span class="line"><span class="comment">%   because the intended target is a C function that will be called on a</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',42);"> 42</a></span><span class="line"><span class="comment">%   sub-millisecond basis. The bizzare enumerations assist the</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',43);"> 43</a></span><span class="line"><span class="comment">%   pass-by-reference functionality that allows this function to fly in</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',44);"> 44</a></span><span class="line"><span class="comment">%   real-time. This function works on a need to know basis, eliminating any</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',45);"> 45</a></span><span class="line"><span class="comment">%   unnecessary data copying or parameter calculation.</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',46);"> 46</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',47);"> 47</a></span><span class="line"><span class="comment">% eml.varsize('frameBuffer', 6192);</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',48);"> 48</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',49);"> 49</a></span><span class="line"><span class="comment">%Fake enumeration - must be kept up to date with c++ enum</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',50);"> 50</a></span><span class="line"><span class="mxinfo" id="T6:U92"><span class="var type1" id="S33T6U58">enumC_ARb</span> = <span class="mxinfo" id="T6:U94">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',51);"> 51</a></span><span class="line"><span class="mxinfo" id="T6:U95"><span class="var type1" id="S34T6U62">enumC_ARa</span> = <span class="mxinfo" id="T6:U97">2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',52);"> 52</a></span><span class="line"><span class="mxinfo" id="T6:U98"><span class="var type1" id="S35T6U66">enumC_MOCb</span> = <span class="mxinfo" id="T6:U100">4</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',53);"> 53</a></span><span class="line"><span class="mxinfo" id="T6:U101"><span class="var type1" id="S36T6U70">enumC_MOCa</span> = <span class="mxinfo" id="T6:U103">6</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',54);"> 54</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',55);"> 55</a></span><span class="line"><span class="comment">% enumC_BPb1 = 8;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',56);"> 56</a></span><span class="line"><span class="comment">% enumC_BPa1 = 13;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',57);"> 57</a></span><span class="line"><span class="comment">% enumC_BPb2 = 18;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',58);"> 58</a></span><span class="line"><span class="comment">% enumC_BPa2 = 23;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',59);"> 59</a></span><span class="line"><span class="comment">% enumC_BPb3 = 28;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',60);"> 60</a></span><span class="line"><span class="comment">% enumC_BPa3 = 33;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',61);"> 61</a></span><span class="line"><span class="comment">% enumC_BPb4 = 38;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',62);"> 62</a></span><span class="line"><span class="comment">% enumC_BPa4 = 43;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',63);"> 63</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',64);"> 64</a></span><span class="line"><span class="mxinfo" id="T6:U104"><span class="var type1" id="S37T6U74">enumS_AR</span>   = <span class="mxinfo" id="T6:U106">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',65);"> 65</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',66);"> 66</a></span><span class="line"><span class="comment">% enumS_MOC1  = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',67);"> 67</a></span><span class="line"><span class="comment">% enumS_BPin_1_1 = 2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',68);"> 68</a></span><span class="line"><span class="comment">% enumS_BPin_2_1 = 6;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',69);"> 69</a></span><span class="line"><span class="comment">% enumS_BPout_1_1 = 10;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',70);"> 70</a></span><span class="line"><span class="comment">% enumS_BPout_2_1 = 14;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',71);"> 71</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',72);"> 72</a></span><span class="line"><span class="comment">% enumS_MOC2 = 18;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',73);"> 73</a></span><span class="line"><span class="comment">% enumS_BPin_1_2 = 19;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',74);"> 74</a></span><span class="line"><span class="comment">% enumS_BPin_2_2 = 23;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',75);"> 75</a></span><span class="line"><span class="comment">% enumS_BPout_1_2 = 27;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',76);"> 76</a></span><span class="line"><span class="comment">% enumS_BPout_2_2 = 31;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',77);"> 77</a></span><span class="line"><span class="comment">% <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',78);"> 78</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',79);"> 79</a></span><span class="line"><span class="comment">% rmsLev[0] = iunput RMS from AR smoothed response</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',80);"> 80</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',81);"> 81</a></span><span class="line"><span class="comment">%Initial gain</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',82);"> 82</a></span><span class="line"><span class="comment">% frameBuffer(1:numSamples) = frameBuffer(1:numSamples)*ipScalar;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',83);"> 83</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',84);"> 84</a></span><span class="line"><span class="mxinfo" id="T6:U107"><span class="var type1" id="S38T6U78">MAX_SAMP</span> = <span class="mxinfo" id="T6:U109">2048</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',85);"> 85</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',86);"> 86</a></span><span class="line"><span class="comment">%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',87);"> 87</a></span><span class="line"><span class="comment">% Place where conversion to velocity once lived</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',88);"> 88</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',89);"> 89</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',90);"> 90</a></span><span class="line"><span class="comment">% tympanic membrane response in meters</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',91);"> 91</a></span><span class="line"><span class="mxinfo" id="T43:U110"><span class="var type1" id="S39T43U82">stapesVelL</span> = <span class="mxinfo" id="T43:U112"><span class="var type1" id="S2T4U84">frameBufferL</span>(<span class="mxinfo" id="T43:U114"><span class="mxinfo" id="T6:U115">1</span>:<span class="var type1" id="S24T6U87">numSamples</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',92);"> 92</a></span><span class="line"><span class="mxinfo" id="T43:U117"><span class="var type1" id="S40T43U90">stapesVelR</span> = <span class="mxinfo" id="T43:U119"><span class="var type1" id="S3T4U92">frameBufferR</span>(<span class="mxinfo" id="T43:U121"><span class="mxinfo" id="T6:U122">1</span>:<span class="var type1" id="S24T6U95">numSamples</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',93);"> 93</a></span><span class="line"><span class="mxinfo" id="T52:U124"><span class="mxinfo" id="T52:U125"><span class="var type1" id="S2T4U99">frameBufferL</span>(<span class="mxinfo" id="T43:U127"><span class="mxinfo" id="T6:U128">1</span>:<span class="var type1" id="S24T6U102">numSamples</span></span>)</span> = <span class="mxinfo" id="T43:U130">zeros(<span class="mxinfo" id="T10:U131">size(<span class="mxinfo" id="T43:U132"><span class="var type1" id="S2T4U108">frameBufferL</span>(<span class="mxinfo" id="T43:U134"><span class="mxinfo" id="T6:U135">1</span>:<span class="var type1" id="S24T6U111">numSamples</span></span>)</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',94);"> 94</a></span><span class="line"><span class="mxinfo" id="T52:U137"><span class="mxinfo" id="T52:U138"><span class="var type1" id="S3T4U115">frameBufferR</span>(<span class="mxinfo" id="T43:U140"><span class="mxinfo" id="T6:U141">1</span>:<span class="var type1" id="S24T6U118">numSamples</span></span>)</span> = <span class="mxinfo" id="T43:U143">zeros(<span class="mxinfo" id="T10:U144">size(<span class="mxinfo" id="T43:U145"><span class="var type1" id="S2T4U124">frameBufferL</span>(<span class="mxinfo" id="T43:U147"><span class="mxinfo" id="T6:U148">1</span>:<span class="var type1" id="S24T6U127">numSamples</span></span>)</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',95);"> 95</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',96);"> 96</a></span><span class="line"><span class="comment">%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',97);"> 97</a></span><span class="line"><span class="comment">% ACOUSTIC REFLEX</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',98);"> 98</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',99);"> 99</a></span><span class="line"><span class="comment">% find  rms of smoothed ip signal</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',100);">100</a></span><span class="line"><span class="comment">%  this will be used to trigger the AR reflex</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',101);">101</a></span><span class="line"><span class="mxinfo" id="T8:U150">[<span class="var type1" id="S43T43U131">yL</span>,  <span class="var type1" id="S4T5U133">filterStatesL</span>(<span class="mxinfo" id="T6:U153"><span class="var type1" id="S37T6U135">enumS_AR</span>+1</span>)] = filter(<span class="mxinfo" id="T13:U155"><span class="var type1" id="S22T7U140">filterCoeffs</span>(<span class="mxinfo" id="T13:U157"><span class="mxinfo" id="T6:U158"><span class="var type1" id="S33T6U143">enumC_ARb</span>+1</span>:<span class="mxinfo" id="T6:U160"><span class="var type1" id="S33T6U146">enumC_ARb</span>+2</span></span>)</span>, <span class="mxinfo" id="T13:U162"><span class="var type1" id="S22T7U149">filterCoeffs</span>(<span class="mxinfo" id="T13:U164"><span class="mxinfo" id="T6:U165"><span class="var type1" id="S34T6U152">enumC_ARa</span>+1</span>:<span class="mxinfo" id="T6:U167"><span class="var type1" id="S34T6U155">enumC_ARa</span>+2</span></span>)</span> , <span class="mxinfo" id="T43:U169"><span class="var type1" id="S39T43U158">stapesVelL</span>.^2</span>, <span class="mxinfo" id="T6:U171"><span class="var type1" id="S4T5U161">filterStatesL</span>(<span class="mxinfo" id="T6:U173"><span class="var type1" id="S37T6U163">enumS_AR</span>+1</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',102);">102</a></span><span class="line"><span class="mxinfo" id="T8:U175">[<span class="var type1" id="S45T43U168">yR</span>,  <span class="var type1" id="S5T5U170">filterStatesR</span>(<span class="mxinfo" id="T6:U178"><span class="var type1" id="S37T6U172">enumS_AR</span>+1</span>)] = filter(<span class="mxinfo" id="T13:U180"><span class="var type1" id="S22T7U177">filterCoeffs</span>(<span class="mxinfo" id="T13:U182"><span class="mxinfo" id="T6:U183"><span class="var type1" id="S33T6U180">enumC_ARb</span>+1</span>:<span class="mxinfo" id="T6:U185"><span class="var type1" id="S33T6U183">enumC_ARb</span>+2</span></span>)</span>, <span class="mxinfo" id="T13:U187"><span class="var type1" id="S22T7U186">filterCoeffs</span>(<span class="mxinfo" id="T13:U189"><span class="mxinfo" id="T6:U190"><span class="var type1" id="S34T6U189">enumC_ARa</span>+1</span>:<span class="mxinfo" id="T6:U192"><span class="var type1" id="S34T6U192">enumC_ARa</span>+2</span></span>)</span> , <span class="mxinfo" id="T43:U194"><span class="var type1" id="S40T43U195">stapesVelR</span>.^2</span>, <span class="mxinfo" id="T6:U196"><span class="var type1" id="S5T5U198">filterStatesR</span>(<span class="mxinfo" id="T6:U198"><span class="var type1" id="S37T6U200">enumS_AR</span>+1</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',103);">103</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',104);">104</a></span><span class="line"><span class="comment">% restore Pa scale</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',105);">105</a></span><span class="line"><span class="mxinfo" id="T43:U200"><span class="var type1" id="S46T43U204">smoothedARrmsL</span> = <span class="mxinfo" id="T43:U202">sqrt(<span class="var type1" id="S43T44U207">yL</span>)</span></span>;  <span class="comment">%confusing name for parameter - it is a short term RMS.</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',106);">106</a></span><span class="line"><span class="mxinfo" id="T43:U204"><span class="var type1" id="S48T43U210">smoothedARrmsR</span> = <span class="mxinfo" id="T43:U206">sqrt(<span class="var type1" id="S45T44U213">yR</span>)</span></span>;  <span class="comment">%confusing name for parameter - it is a short term RMS.</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',107);">107</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',108);">108</a></span><span class="line"><span class="comment">% attenuate input (NB cross product used)</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',109);">109</a></span><span class="line"><span class="mxinfo" id="T43:U208"><span class="var type1" id="S39T43U216">stapesVelL</span> = <span class="mxinfo" id="T43:U210"><span class="var type1" id="S39T43U218">stapesVelL</span>./<span class="mxinfo" id="T43:U212"><span class="var type1" id="S6T4U220">ARampL</span>(<span class="mxinfo" id="T43:U214"><span class="mxinfo" id="T6:U215">1</span>:<span class="var type1" id="S24T6U223">numSamples</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',110);">110</a></span><span class="line"><span class="mxinfo" id="T43:U217"><span class="var type1" id="S40T43U226">stapesVelR</span> = <span class="mxinfo" id="T43:U219"><span class="var type1" id="S40T43U228">stapesVelR</span>./<span class="mxinfo" id="T43:U221"><span class="var type1" id="S7T4U230">ARampR</span>(<span class="mxinfo" id="T43:U223"><span class="mxinfo" id="T6:U224">1</span>:<span class="var type1" id="S24T6U233">numSamples</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',111);">111</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',112);">112</a></span><span class="line"><span class="comment">%CALC ARamp FOR NEXT FRAME</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',113);">113</a></span><span class="line"><span class="comment">% compare levels in the previous segment with AR threshold</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',114);">114</a></span><span class="line"><span class="mxinfo" id="T52:U226"><span class="mxinfo" id="T52:U227"><span class="var type1" id="S6T4U237">ARampL</span>(<span class="mxinfo" id="T43:U229"><span class="mxinfo" id="T6:U230">1</span>:<span class="var type1" id="S24T6U240">numSamples</span></span>)</span> = <span class="mxinfo" id="T43:U232"><span class="var type1" id="S46T43U242">smoothedARrmsL</span>/<span class="var type1" id="S25T6U243">ARthresholdPa</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',115);">115</a></span><span class="line"><span class="mxinfo" id="T52:U235"><span class="mxinfo" id="T52:U236"><span class="var type1" id="S7T4U247">ARampR</span>(<span class="mxinfo" id="T43:U238"><span class="mxinfo" id="T6:U239">1</span>:<span class="var type1" id="S24T6U250">numSamples</span></span>)</span> = <span class="mxinfo" id="T43:U241"><span class="var type1" id="S48T43U252">smoothedARrmsR</span>/<span class="var type1" id="S25T6U253">ARthresholdPa</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',116);">116</a></span><span class="line"><span class="comment">% all sub-treshold values are set to 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',117);">117</a></span><span class="line"><span class="mxinfo" id="T43:U244"><span class="mxinfo" id="T43:U245"><span class="var type1" id="S6T4U257">ARampL</span>(<span class="mxinfo" id="T46:U247"><span class="mxinfo" id="T43:U248"><span class="var type1" id="S6T4U260">ARampL</span>(<span class="mxinfo" id="T43:U250"><span class="mxinfo" id="T6:U251">1</span>:<span class="var type1" id="S24T6U263">numSamples</span></span>)</span>&lt;<span class="mxinfo" id="T6:U253">1</span></span>)</span>=<span class="mxinfo" id="T6:U254">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',118);">118</a></span><span class="line"><span class="mxinfo" id="T43:U255"><span class="mxinfo" id="T43:U256"><span class="var type1" id="S7T4U269">ARampR</span>(<span class="mxinfo" id="T46:U258"><span class="mxinfo" id="T43:U259"><span class="var type1" id="S7T4U272">ARampR</span>(<span class="mxinfo" id="T43:U261"><span class="mxinfo" id="T6:U262">1</span>:<span class="var type1" id="S24T6U275">numSamples</span></span>)</span>&lt;<span class="mxinfo" id="T6:U264">1</span></span>)</span>=<span class="mxinfo" id="T6:U265">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',119);">119</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',120);">120</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',121);">121</a></span><span class="line"><span class="comment">%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',122);">122</a></span><span class="line"><span class="comment">% DRNL</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',123);">123</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',124);">124</a></span><span class="line"><span class="mxinfo" id="T44:U266"><span class="var type1" id="S43T44U280">yL</span>=<span class="var type1" id="S39T43U281">stapesVelL</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',125);">125</a></span><span class="line"><span class="mxinfo" id="T44:U269"><span class="var type1" id="S45T44U284">yR</span>=<span class="var type1" id="S40T43U285">stapesVelR</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',126);">126</a></span><span class="line"><span class="mxinfo" id="T25:U272"><span class="var type1" id="S49T25U288">xmzpL</span> = <span class="mxinfo" id="T25:U274">zeros(<span class="var type1" id="S38T6U291">MAX_SAMP</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',127);">127</a></span><span class="line"><span class="mxinfo" id="T25:U276"><span class="var type1" id="S50T25U295">xmzpR</span> = <span class="mxinfo" id="T25:U278">zeros(<span class="var type1" id="S38T6U298">MAX_SAMP</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',128);">128</a></span><span class="line"><span class="mxinfo" id="T53:U280"><span class="mxinfo" id="T53:U281"><span class="var type1" id="S49T25U303">xmzpL</span>(<span class="mxinfo" id="T51:U283"><span class="mxinfo" id="T6:U284">1</span>:<span class="var type1" id="S31T6U306">nfft</span></span>)</span> = <span class="mxinfo" id="T8:U286">[<span class="var type1" id="S43T44U309">yL</span>; <span class="mxinfo" id="T8:U288"><span class="message error" id="M1F1C">zeros(<span class="mxinfo" id="T6:U289"><span class="var type1" id="S31T6U314">nfft</span>-<span class="var type1" id="S24T6U315">numSamples</span></span>,1)</span></span>]</span></span>; <span class="comment">% zero pad the signal</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',129);">129</a></span><span class="line"><span class="mxinfo" id="T53:U292"><span class="mxinfo" id="T53:U293"><span class="var type1" id="S50T25U320">xmzpR</span>(<span class="mxinfo" id="T51:U295"><span class="mxinfo" id="T6:U296">1</span>:<span class="var type1" id="S31T6U323">nfft</span></span>)</span> = <span class="mxinfo" id="T8:U298">[<span class="var type1" id="S45T44U326">yR</span>; <span class="mxinfo" id="T8:U300"><span class="message error" id="M2F1C">zeros(<span class="mxinfo" id="T6:U301"><span class="var type1" id="S31T6U331">nfft</span>-<span class="var type1" id="S24T6U332">numSamples</span></span>,1)</span></span>]</span></span>; <span class="comment">% zero pad the signal</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',130);">130</a></span><span class="line"><span class="mxinfo" id="T30:U304"><span class="var type1" id="S51T30U336">XmL</span> = <span class="mxinfo" id="T30:U306"><span class="message error" id="M3F1C">fft(<span class="var type1" id="S49T25U339">xmzpL</span>,<span class="var type1" id="S31T6U340">nfft</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',131);">131</a></span><span class="line"><span class="mxinfo" id="T30:U309"><span class="var type1" id="S53T30U343">XmR</span> = <span class="mxinfo" id="T30:U311"><span class="message error" id="M4F1C">fft(<span class="var type1" id="S50T25U346">xmzpR</span>,<span class="var type1" id="S31T6U347">nfft</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',132);">132</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',133);">133</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S54T31U350">filterCount</span>=<span class="mxinfo" id="T31:U315">1</span>:<span class="var type1" id="S23T31U353">numChannels</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',134);">134</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',135);">135</a></span><span class="line">    <span class="mxinfo" id="T43:U317"><span class="var type1" id="S55T43U356">MOCnow</span> = <span class="mxinfo" id="T43:U319"><span class="var type1" id="S17T2U358">MOCcontrol</span>( <span class="mxinfo" id="T43:U321"><span class="mxinfo" id="T6:U322">1</span>:<span class="var type1" id="S24T6U361">numSamples</span></span>, <span class="var type1" id="S54T31U362">filterCount</span> )</span></span>; <span class="comment">%syntactic shorthand</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',136);">136</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',137);">137</a></span><span class="line"><span class="comment">%     if useGTF</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',138);">138</a></span><span class="line"><span class="comment">%         assert(filterOrder &lt; 5, 'filterOrder must be less than 5')</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',139);">139</a></span><span class="line"><span class="comment">%         for nn = 1:filterOrder;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',140);">140</a></span><span class="line"><span class="comment">%             [yL, filterStatesL(17*(filterCount-1)+3+(nn-1)*2   :  17*(filterCount-1)+4+(nn-1)*2)] =  filter(filterCoeffs(10*(filterCount-1)+9:10*(filterCount-1)+10), filterCoeffs(10*(filterCount-1)+14:10*(filterCount-1)+16), yL, filterStatesL(17*(filterCount-1)+3+(nn-1)*2   :  17*(filterCount-1)+4+(nn-1)*2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',141);">141</a></span><span class="line"><span class="comment">%             [yR, filterStatesR(17*(filterCount-1)+3+(nn-1)*2   :  17*(filterCount-1)+4+(nn-1)*2)] =  filter(filterCoeffs(10*(filterCount-1)+9:10*(filterCount-1)+10), filterCoeffs(10*(filterCount-1)+14:10*(filterCount-1)+16), yR, filterStatesR(17*(filterCount-1)+3+(nn-1)*2   :  17*(filterCount-1)+4+(nn-1)*2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',142);">142</a></span><span class="line"><span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',143);">143</a></span><span class="line"><span class="comment">%     else</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',144);">144</a></span><span class="line"><span class="comment">%         assert(filterOrder == 2 || filterOrder == 4, 'filterOrder must be 2 or 4')</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',145);">145</a></span><span class="line"><span class="comment">%         for nn = 1:filterOrder/2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',146);">146</a></span><span class="line"><span class="comment">%             [yL, filterStatesL(17*(filterCount-1)+3+(nn-1)*4   :  17*(filterCount-1)+6+(nn-1)*4)] =  filter(filterCoeffs(10*(filterCount-1)+9:10*(filterCount-1)+13), filterCoeffs(10*(filterCount-1)+14:10*(filterCount-1)+18), yL, filterStatesL(17*(filterCount-1)+3+(nn-1)*4   :  17*(filterCount-1)+6+(nn-1)*4));</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',147);">147</a></span><span class="line"><span class="comment">%             [yR, filterStatesR(17*(filterCount-1)+3+(nn-1)*4   :  17*(filterCount-1)+6+(nn-1)*4)] =  filter(filterCoeffs(10*(filterCount-1)+9:10*(filterCount-1)+13), filterCoeffs(10*(filterCount-1)+14:10*(filterCount-1)+18), yR, filterStatesR(17*(filterCount-1)+3+(nn-1)*4   :  17*(filterCount-1)+6+(nn-1)*4));</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',148);">148</a></span><span class="line"><span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',149);">149</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',150);">150</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',151);">151</a></span><span class="line">    <span class="comment">%OVERLAP ADD</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',152);">152</a></span><span class="line"><span class="comment">%     index = m*M+1:min(m*M+M,Nsig); % indices for the mth frame</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',153);">153</a></span><span class="line"><span class="comment">%     xm = sig(index);  % windowed mth frame (rectangular window)</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',154);">154</a></span><span class="line"><span class="comment">%     size()</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',155);">155</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',156);">156</a></span><span class="line">    <span class="mxinfo" id="T45:U325"><span class="var type1" id="S56T45U365">YmL</span> = <span class="var type1" id="S51T30U367">XmL</span> .* <span class="mxinfo" id="T45:U328"><span class="var type1" id="S32T32U369">H</span>(<span class="mxinfo" id="T44:U330"><span class="mxinfo" id="T6:U331">1</span>:<span class="var type1" id="S31T6U372">nfft</span></span>,<span class="var type1" id="S54T31U373">filterCount</span>)</span></span>;   <span class="comment">% freq domain multiplication</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',157);">157</a></span><span class="line">    <span class="mxinfo" id="T45:U334"><span class="var type1" id="S57T45U376">YmR</span> = <span class="var type1" id="S53T30U378">XmR</span> .* <span class="mxinfo" id="T45:U337"><span class="var type1" id="S32T32U380">H</span>(<span class="mxinfo" id="T44:U339"><span class="mxinfo" id="T6:U340">1</span>:<span class="var type1" id="S31T6U383">nfft</span></span>,<span class="var type1" id="S54T31U384">filterCount</span>)</span></span>;   <span class="comment">% freq domain multiplication</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',158);">158</a></span><span class="line">    <span class="mxinfo" id="T44:U343"><span class="var type1" id="S58T44U387">ymL</span> = <span class="mxinfo" id="T44:U345">real(  <span class="mxinfo" id="T45:U346">ifft(<span class="var type1" id="S56T45U392">YmL</span>)</span>  )</span></span>;         <span class="comment">% inverse transform % REAL there for eml coder</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',159);">159</a></span><span class="line">    <span class="mxinfo" id="T44:U348"><span class="var type1" id="S61T44U395">ymR</span> = <span class="mxinfo" id="T44:U350">real(  <span class="mxinfo" id="T45:U351">ifft(<span class="var type1" id="S57T45U400">YmR</span>)</span>  )</span></span>;         <span class="comment">% inverse transform % REAL there for eml coder</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',160);">160</a></span><span class="line">    <span class="mxinfo" id="T44:U353"><span class="mxinfo" id="T44:U354"><span class="var type1" id="S18T1U404">FILO_iL</span>(<span class="mxinfo" id="T44:U356"><span class="mxinfo" id="T6:U357">1</span>:<span class="var type1" id="S31T6U407">nfft</span></span>,<span class="var type1" id="S54T31U408">filterCount</span>)</span> =   <span class="mxinfo" id="T44:U360"><span class="mxinfo" id="T8:U361">[<span class="mxinfo" id="T44:U362"><span class="var type1" id="S18T1U413">FILO_iL</span>(<span class="mxinfo" id="T44:U364"><span class="mxinfo" id="T6:U365"><span class="var type1" id="S24T6U416">numSamples</span>+<span class="mxinfo" id="T6:U367">1</span></span>:<span class="mxinfo" id="T6:U368">end</span></span>,<span class="var type1" id="S54T31U420">filterCount</span>)</span>; <span class="mxinfo" id="T8:U370"><span class="message error" id="M5F1C">zeros(<span class="var type1" id="S24T6U424">numSamples</span>,1)</span></span>]</span> + <span class="var type1" id="S58T44U426">ymL</span></span></span>   ; <span class="comment">%first in, last out buffer</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',161);">161</a></span><span class="line">    <span class="mxinfo" id="T44:U373"><span class="mxinfo" id="T44:U374"><span class="var type1" id="S19T1U430">FILO_iR</span>(<span class="mxinfo" id="T44:U376"><span class="mxinfo" id="T6:U377">1</span>:<span class="var type1" id="S31T6U433">nfft</span></span>,<span class="var type1" id="S54T31U434">filterCount</span>)</span> =   <span class="mxinfo" id="T44:U380"><span class="mxinfo" id="T8:U381">[<span class="mxinfo" id="T44:U382"><span class="var type1" id="S19T1U439">FILO_iR</span>(<span class="mxinfo" id="T44:U384"><span class="mxinfo" id="T6:U385"><span class="var type1" id="S24T6U442">numSamples</span>+<span class="mxinfo" id="T6:U387">1</span></span>:<span class="mxinfo" id="T6:U388">end</span></span>,<span class="var type1" id="S54T31U446">filterCount</span>)</span>; <span class="mxinfo" id="T8:U390"><span class="message error" id="M6F1C">zeros(<span class="var type1" id="S24T6U450">numSamples</span>,1)</span></span>]</span> + <span class="var type1" id="S61T44U452">ymR</span></span></span>   ; <span class="comment">%first in, last out buffer</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',162);">162</a></span><span class="line">    <span class="mxinfo" id="T44:U393"><span class="var type1" id="S43T44U455">yL</span> = <span class="mxinfo" id="T44:U395"><span class="var type1" id="S18T1U457">FILO_iL</span>(<span class="mxinfo" id="T44:U397"><span class="mxinfo" id="T6:U398">1</span>:<span class="var type1" id="S24T6U460">numSamples</span></span>,<span class="var type1" id="S54T31U461">filterCount</span>)</span></span>; <span class="comment">% overlap add</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',163);">163</a></span><span class="line">    <span class="mxinfo" id="T44:U401"><span class="var type1" id="S45T44U464">yR</span> = <span class="mxinfo" id="T44:U403"><span class="var type1" id="S19T1U466">FILO_iR</span>(<span class="mxinfo" id="T44:U405"><span class="mxinfo" id="T6:U406">1</span>:<span class="var type1" id="S24T6U469">numSamples</span></span>,<span class="var type1" id="S54T31U470">filterCount</span>)</span></span>; <span class="comment">% overlap add</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',164);">164</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',165);">165</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',166);">166</a></span><span class="line">    <span class="mxinfo" id="T6:U409"><span class="mxinfo" id="T6:U410"><span class="var type1" id="S9T3U474">peakIPL</span>(<span class="var type1" id="S54T31U475">filterCount</span>)</span> = <span class="mxinfo" id="T6:U413"><span class="mxinfo" id="T6:U414">20</span>*<span class="mxinfo" id="T6:U415">log10(   <span class="mxinfo" id="T6:U416"><span class="mxinfo" id="T6:U417">max(<span class="mxinfo" id="T44:U418">abs(<span class="var type1" id="S43T44U485">yL</span>)</span>)</span> /<span class="mxinfo" id="T6:U420">2e-5</span></span>   )</span></span></span>; <span class="comment">%peak in in dB SPL</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',167);">167</a></span><span class="line">    <span class="mxinfo" id="T6:U421"><span class="mxinfo" id="T6:U422"><span class="var type1" id="S13T3U490">peakIPR</span>(<span class="var type1" id="S54T31U491">filterCount</span>)</span> = <span class="mxinfo" id="T6:U425"><span class="mxinfo" id="T6:U426">20</span>*<span class="mxinfo" id="T6:U427">log10(   <span class="mxinfo" id="T6:U428"><span class="mxinfo" id="T6:U429">max(<span class="mxinfo" id="T44:U430">abs(<span class="var type1" id="S45T44U501">yR</span>)</span>)</span> /<span class="mxinfo" id="T6:U432">2e-5</span></span>   )</span></span></span>; <span class="comment">%peak in in dB SPL</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',168);">168</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',169);">169</a></span><span class="line"><span class="comment">%     rmsIPL(filterCount) = 20*log10(  sqrt(mean(yL.^2)) /2e-5 ); %rms in in dB SPL</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',170);">170</a></span><span class="line"><span class="comment">%     rmsIPR(filterCount) = 20*log10(  sqrt(mean(yR.^2)) /2e-5 ); %rms in in dB SPL</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',171);">171</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',172);">172</a></span><span class="line">    <span class="mxinfo" id="T6:U433"><span class="mxinfo" id="T6:U434"><span class="var type1" id="S11T3U506">rmsIPL</span>(<span class="var type1" id="S54T31U507">filterCount</span>)</span> = <span class="mxinfo" id="T6:U437"><span class="mxinfo" id="T6:U438">20</span>*<span class="mxinfo" id="T6:U439">log10(  <span class="mxinfo" id="T6:U440"><span class="mxinfo" id="T6:U441">abs(<span class="mxinfo" id="T6:U442"><span class="var type1" id="S43T44U516">yL</span>(<span class="mxinfo" id="T6:U444">end</span>)</span>)</span> /<span class="mxinfo" id="T6:U445">2e-5</span></span> )</span></span></span>; <span class="comment">%rms in in dB SPL for GUI (bit of a hack, but it is smoothed in GUI)</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',173);">173</a></span><span class="line">    <span class="mxinfo" id="T6:U446"><span class="mxinfo" id="T6:U447"><span class="var type1" id="S15T3U523">rmsIPR</span>(<span class="var type1" id="S54T31U524">filterCount</span>)</span> = <span class="mxinfo" id="T6:U450"><span class="mxinfo" id="T6:U451">20</span>*<span class="mxinfo" id="T6:U452">log10(  <span class="mxinfo" id="T6:U453"><span class="mxinfo" id="T6:U454">abs(<span class="mxinfo" id="T6:U455"><span class="var type1" id="S45T44U533">yR</span>(<span class="mxinfo" id="T6:U457">end</span>)</span>)</span> /<span class="mxinfo" id="T6:U458">2e-5</span></span> )</span></span></span>; <span class="comment">%rms in in dB SPL  </span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',174);">174</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',175);">175</a></span><span class="line">    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',176);">176</a></span><span class="line">    <span class="comment">% compression time</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',177);">177</a></span><span class="line">    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',178);">178</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',179);">179</a></span><span class="line">    <span class="comment">% MOC compression first</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',180);">180</a></span><span class="line">    <span class="mxinfo" id="T44:U459"><span class="var type1" id="S43T44U539">yL</span> = <span class="mxinfo" id="T44:U461"><span class="var type1" id="S43T44U541">yL</span>.*<span class="var type1" id="S55T43U542">MOCnow</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',181);">181</a></span><span class="line">    <span class="mxinfo" id="T44:U464"><span class="var type1" id="S45T44U545">yR</span> = <span class="mxinfo" id="T44:U466"><span class="var type1" id="S45T44U547">yR</span>.*<span class="var type1" id="S55T43U548">MOCnow</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',182);">182</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',183);">183</a></span><span class="line">    <span class="comment">% Instantaneous after</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',184);">184</a></span><span class="line">    <span class="mxinfo" id="T6:U469"><span class="var type1" id="S66T6U551">DRNLa</span> = <span class="mxinfo" id="T6:U471">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',185);">185</a></span><span class="line">    <span class="mxinfo" id="T44:U472"><span class="var type1" id="S43T44U555">yL</span> = <span class="mxinfo" id="T44:U474"><span class="fcn" id="F132N3:B557">DRNL_brokenstick_nl</span> (<span class="var type1" id="S43T44U558">yL</span>, <span class="var type1" id="S66T6U559">DRNLa</span>, <span class="mxinfo" id="T6:U477"><span class="var type1" id="S26T37U561">DRNLb</span>(<span class="var type1" id="S54T31U562">filterCount</span>)</span>, <span class="mxinfo" id="T6:U480"><span class="var type1" id="S27T37U564">DRNLc</span>(<span class="var type1" id="S54T31U565">filterCount</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',186);">186</a></span><span class="line">    <span class="mxinfo" id="T44:U483"><span class="var type1" id="S45T44U568">yR</span> = <span class="mxinfo" id="T44:U485"><span class="fcn" id="F132N3:B570">DRNL_brokenstick_nl</span> (<span class="var type1" id="S45T44U571">yR</span>, <span class="var type1" id="S66T6U572">DRNLa</span>, <span class="mxinfo" id="T6:U488"><span class="var type1" id="S26T37U574">DRNLb</span>(<span class="var type1" id="S54T31U575">filterCount</span>)</span>, <span class="mxinfo" id="T6:U491"><span class="var type1" id="S27T37U577">DRNLc</span>(<span class="var type1" id="S54T31U578">filterCount</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',187);">187</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',188);">188</a></span><span class="line"><span class="comment">%     if useGTF</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',189);">189</a></span><span class="line"><span class="comment">%         for nn = 1:filterOrder;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',190);">190</a></span><span class="line"><span class="comment">%             [yL, filterStatesL(17*(filterCount-1)+11+(nn-1)*2   :  17*(filterCount-1)+12+(nn-1)*2)] =  filter(filterCoeffs(10*(filterCount-1)+9:10*(filterCount-1)+10), filterCoeffs(10*(filterCount-1)+14:10*(filterCount-1)+16), yL, filterStatesL(17*(filterCount-1)+11+(nn-1)*2   :  17*(filterCount-1)+12+(nn-1)*2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',191);">191</a></span><span class="line"><span class="comment">%             [yR, filterStatesR(17*(filterCount-1)+11+(nn-1)*2   :  17*(filterCount-1)+12+(nn-1)*2)] =  filter(filterCoeffs(10*(filterCount-1)+9:10*(filterCount-1)+10), filterCoeffs(10*(filterCount-1)+14:10*(filterCount-1)+16), yR, filterStatesR(17*(filterCount-1)+11+(nn-1)*2   :  17*(filterCount-1)+12+(nn-1)*2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',192);">192</a></span><span class="line"><span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',193);">193</a></span><span class="line"><span class="comment">%     else</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',194);">194</a></span><span class="line"><span class="comment">%         for nn = 1:filterOrder/2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',195);">195</a></span><span class="line"><span class="comment">%             [yL, filterStatesL(17*(filterCount-1)+11+(nn-1)*4   :  17*(filterCount-1)+14+(nn-1)*4)] =  filter(filterCoeffs(10*(filterCount-1)+9:10*(filterCount-1)+13), filterCoeffs(10*(filterCount-1)+14:10*(filterCount-1)+18), yL, filterStatesL(17*(filterCount-1)+11+(nn-1)*4   :  17*(filterCount-1)+14+(nn-1)*4));</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',196);">196</a></span><span class="line"><span class="comment">%             [yR, filterStatesR(17*(filterCount-1)+11+(nn-1)*4   :  17*(filterCount-1)+14+(nn-1)*4)] =  filter(filterCoeffs(10*(filterCount-1)+9:10*(filterCount-1)+13), filterCoeffs(10*(filterCount-1)+14:10*(filterCount-1)+18), yR, filterStatesR(17*(filterCount-1)+11+(nn-1)*4   :  17*(filterCount-1)+14+(nn-1)*4));</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',197);">197</a></span><span class="line"><span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',198);">198</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',199);">199</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',200);">200</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',201);">201</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',202);">202</a></span><span class="line">    <span class="mxinfo" id="T8:U494"><span class="var type1" id="S68T8U581">xmzpLo</span> = <span class="mxinfo" id="T8:U496">[<span class="var type1" id="S43T44U584">yL</span>; <span class="mxinfo" id="T8:U498"><span class="message error" id="M7F1C">zeros(<span class="mxinfo" id="T6:U499"><span class="var type1" id="S31T6U589">nfft</span>-<span class="var type1" id="S24T6U590">numSamples</span></span>,1)</span></span>]</span></span>; <span class="comment">% zero pad the signal</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',203);">203</a></span><span class="line">    <span class="mxinfo" id="T8:U502"><span class="var type1" id="S69T8U594">xmzpRo</span> = <span class="mxinfo" id="T8:U504">[<span class="var type1" id="S45T44U597">yR</span>; <span class="mxinfo" id="T8:U506"><span class="message error" id="M8F1C">zeros(<span class="mxinfo" id="T6:U507"><span class="var type1" id="S31T6U602">nfft</span>-<span class="var type1" id="S24T6U603">numSamples</span></span>,1)</span></span>]</span></span>; <span class="comment">% zero pad the signal</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',204);">204</a></span><span class="line">    <span class="mxinfo" id="T30:U510"><span class="var type1" id="S70T30U607">XmLo</span> = <span class="mxinfo" id="T30:U512">fft(<span class="var type1" id="S68T8U610">xmzpLo</span>,<span class="var type1" id="S31T6U611">nfft</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',205);">205</a></span><span class="line">    <span class="mxinfo" id="T30:U515"><span class="var type1" id="S71T30U614">XmRo</span> = <span class="mxinfo" id="T30:U517">fft(<span class="var type1" id="S69T8U617">xmzpRo</span>,<span class="var type1" id="S31T6U618">nfft</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',206);">206</a></span><span class="line">    <span class="mxinfo" id="T45:U520"><span class="var type1" id="S56T45U621">YmL</span> = <span class="var type1" id="S70T30U623">XmLo</span> .* <span class="mxinfo" id="T45:U523"><span class="var type1" id="S32T32U625">H</span>(<span class="mxinfo" id="T44:U525"><span class="mxinfo" id="T6:U526">1</span>:<span class="var type1" id="S31T6U628">nfft</span></span>,<span class="var type1" id="S54T31U629">filterCount</span>)</span></span>;   <span class="comment">% freq domain multiplication</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',207);">207</a></span><span class="line">    <span class="mxinfo" id="T45:U529"><span class="var type1" id="S57T45U632">YmR</span> = <span class="var type1" id="S71T30U634">XmRo</span> .* <span class="mxinfo" id="T45:U532"><span class="var type1" id="S32T32U636">H</span>(<span class="mxinfo" id="T44:U534"><span class="mxinfo" id="T6:U535">1</span>:<span class="var type1" id="S31T6U639">nfft</span></span>,<span class="var type1" id="S54T31U640">filterCount</span>)</span></span>;   <span class="comment">% freq domain multiplication</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',208);">208</a></span><span class="line">    <span class="mxinfo" id="T44:U538"><span class="var type1" id="S58T44U643">ymL</span> = <span class="mxinfo" id="T44:U540">real(  <span class="mxinfo" id="T45:U541">ifft(<span class="var type1" id="S56T45U648">YmL</span>)</span>  )</span></span>;         <span class="comment">% inverse transform % REAL there for eml coder</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',209);">209</a></span><span class="line">    <span class="mxinfo" id="T44:U543"><span class="var type1" id="S61T44U651">ymR</span> = <span class="mxinfo" id="T44:U545">real(  <span class="mxinfo" id="T45:U546">ifft(<span class="var type1" id="S57T45U656">YmR</span>)</span>  )</span></span>;         <span class="comment">% inverse transform % REAL there for eml code</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',210);">210</a></span><span class="line">    <span class="mxinfo" id="T54:U548"><span class="mxinfo" id="T54:U549"><span class="var type1" id="S20T1U660">FILO_oL</span>(<span class="mxinfo" id="T55:U551">:</span>,<span class="var type1" id="S54T31U662">filterCount</span>)</span> = <span class="mxinfo" id="T44:U553"><span class="mxinfo" id="T8:U554">[<span class="mxinfo" id="T44:U555"><span class="var type1" id="S20T1U667">FILO_oL</span>(<span class="mxinfo" id="T44:U557"><span class="mxinfo" id="T6:U558"><span class="var type1" id="S24T6U670">numSamples</span>+<span class="mxinfo" id="T6:U560">1</span></span>:<span class="mxinfo" id="T6:U561">end</span></span>,<span class="var type1" id="S54T31U674">filterCount</span>)</span>; <span class="mxinfo" id="T8:U563"><span class="message error" id="M9F1C">zeros(<span class="var type1" id="S24T6U678">numSamples</span>,1)</span></span>]</span> + <span class="var type1" id="S58T44U680">ymL</span></span></span>   ; <span class="comment">%first in, last out buffer</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',211);">211</a></span><span class="line">    <span class="mxinfo" id="T54:U566"><span class="mxinfo" id="T54:U567"><span class="var type1" id="S21T1U684">FILO_oR</span>(<span class="mxinfo" id="T55:U569">:</span>,<span class="var type1" id="S54T31U686">filterCount</span>)</span> = <span class="mxinfo" id="T44:U571"><span class="mxinfo" id="T8:U572">[<span class="mxinfo" id="T44:U573"><span class="var type1" id="S21T1U691">FILO_oR</span>(<span class="mxinfo" id="T44:U575"><span class="mxinfo" id="T6:U576"><span class="var type1" id="S24T6U694">numSamples</span>+<span class="mxinfo" id="T6:U578">1</span></span>:<span class="mxinfo" id="T6:U579">end</span></span>,<span class="var type1" id="S54T31U698">filterCount</span>)</span>; <span class="mxinfo" id="T8:U581"><span class="message error" id="M10F1C">zeros(<span class="var type1" id="S24T6U702">numSamples</span>,1)</span></span>]</span> + <span class="var type1" id="S61T44U704">ymR</span></span></span>   ; <span class="comment">%first in, last out buffer</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',212);">212</a></span><span class="line">    <span class="mxinfo" id="T44:U584"><span class="var type1" id="S43T44U707">yL</span> = <span class="mxinfo" id="T44:U586"><span class="var type1" id="S20T1U709">FILO_oL</span>(<span class="mxinfo" id="T44:U588"><span class="mxinfo" id="T6:U589">1</span>:<span class="var type1" id="S24T6U712">numSamples</span></span>,<span class="var type1" id="S54T31U713">filterCount</span>)</span></span>; <span class="comment">% overlap add</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',213);">213</a></span><span class="line">    <span class="mxinfo" id="T44:U592"><span class="var type1" id="S45T44U716">yR</span> = <span class="mxinfo" id="T44:U594"><span class="var type1" id="S21T1U718">FILO_oR</span>(<span class="mxinfo" id="T44:U596"><span class="mxinfo" id="T6:U597">1</span>:<span class="var type1" id="S24T6U721">numSamples</span></span>,<span class="var type1" id="S54T31U722">filterCount</span>)</span></span>; <span class="comment">% overlap add</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',214);">214</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',215);">215</a></span><span class="line">    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',216);">216</a></span><span class="line">    <span class="comment">% Deal with MOC control signal for next frame</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',217);">217</a></span><span class="line">    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',218);">218</a></span><span class="line">    <span class="mxinfo" id="T44:U600"><span class="var type1" id="S72T44U725">yLdB</span> = <span class="mxinfo" id="T44:U602"><span class="mxinfo" id="T6:U603">20</span>*<span class="mxinfo" id="T44:U604">log10(  <span class="mxinfo" id="T44:U605">(<span class="mxinfo" id="T44:U606">(<span class="mxinfo" id="T6:U607">2</span>^-16) + <span class="mxinfo" id="T44:U608">abs(<span class="var type1" id="S43T44U740">yL</span>)</span></span>) / <span class="mxinfo" id="T6:U610">20e-6</span></span>  )</span></span></span>; <span class="comment">%dB peak level with 16 bit offset</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',219);">219</a></span><span class="line">    <span class="mxinfo" id="T44:U611"><span class="var type1" id="S73T44U744">yRdB</span> = <span class="mxinfo" id="T44:U613"><span class="mxinfo" id="T6:U614">20</span>*<span class="mxinfo" id="T44:U615">log10(  <span class="mxinfo" id="T44:U616">(<span class="mxinfo" id="T44:U617">(<span class="mxinfo" id="T6:U618">2</span>^-16) + <span class="mxinfo" id="T44:U619">abs(<span class="var type1" id="S45T44U759">yR</span>)</span></span>) / <span class="mxinfo" id="T6:U621">20e-6</span></span>  )</span></span></span>; <span class="comment">%dB peak level with 16 bit offset</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',220);">220</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',221);">221</a></span><span class="line">    <span class="mxinfo" id="T6:U622">[<span class="var type1" id="S55T6U764">MOCnow</span>,  <span class="var type1" id="S4T5U766">filterStatesL</span>(<span class="mxinfo" id="T31:U625"><span class="mxinfo" id="T31:U626">17*(<span class="mxinfo" id="T31:U627"><span class="var type1" id="S54T31U772">filterCount</span>-<span class="mxinfo" id="T31:U629">1</span></span>)</span>+<span class="mxinfo" id="T31:U630">2</span></span>)]=  filter(<span class="mxinfo" id="T13:U631"><span class="var type1" id="S22T7U778">filterCoeffs</span>(<span class="mxinfo" id="T13:U633"><span class="mxinfo" id="T6:U634"><span class="var type1" id="S35T6U781">enumC_MOCb</span>+1</span>:<span class="mxinfo" id="T6:U636"><span class="var type1" id="S35T6U784">enumC_MOCb</span>+2</span></span>)</span>, <span class="mxinfo" id="T13:U638"><span class="var type1" id="S22T7U787">filterCoeffs</span>(<span class="mxinfo" id="T13:U640"><span class="mxinfo" id="T6:U641"><span class="var type1" id="S36T6U790">enumC_MOCa</span>+1</span>:<span class="mxinfo" id="T6:U643"><span class="var type1" id="S36T6U793">enumC_MOCa</span>+2</span></span>)</span> , <span class="mxinfo" id="T6:U645">mean(<span class="mxinfo" id="T51:U646">[<span class="mxinfo" id="T44:U647"><span class="var type1" id="S72T44U800">yLdB</span>+<span class="mxinfo" id="T6:U649">6</span></span>; <span class="mxinfo" id="T44:U650"><span class="var type1" id="S73T44U804">yRdB</span>+<span class="mxinfo" id="T6:U652">6</span></span>]</span>)</span>, <span class="mxinfo" id="T6:U653"><span class="var type1" id="S4T5U807">filterStatesL</span>(<span class="mxinfo" id="T31:U655"><span class="mxinfo" id="T31:U656">17*(<span class="mxinfo" id="T31:U657"><span class="var type1" id="S54T31U813">filterCount</span>-<span class="mxinfo" id="T31:U659">1</span></span>)</span>+<span class="mxinfo" id="T31:U660">2</span></span>)</span>)</span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',222);">222</a></span><span class="line"><span class="comment">%     [MOCnow,  filterStatesL(17*(filterCount-1)+2)]=  filter(filterCoeffs(enumC_MOCb+1:enumC_MOCb+2), filterCoeffs(enumC_MOCa+1:enumC_MOCa+2) , mean([yL.^2; yR.^2]), filterStatesL(17*(filterCount-1)+2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',223);">223</a></span><span class="line"><span class="comment">%     MOCnow = sqrt(MOCnow);    % restore to meaningful scale (meters - not anymore now in velocity mode)</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',224);">224</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',225);">225</a></span><span class="line">    <span class="mxinfo" id="T6:U661"><span class="var type1" id="S55T6U818">MOCnow</span> = <span class="mxinfo" id="T6:U663"><span class="var type1" id="S55T6U820">MOCnow</span> - <span class="mxinfo" id="T6:U665"><span class="var type1" id="S28T37U822">MOCthreshold_dBOP</span>(<span class="var type1" id="S54T31U823">filterCount</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',226);">226</a></span><span class="line"><span class="comment">%     MOCnow = 20*log10( MOCnow /  20e-6 ) - MOCthreshold_dBOP(filterCount);</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',227);">227</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',228);">228</a></span><span class="line">    <span class="mxinfo" id="T6:U668"><span class="var type1" id="S55T6U826">MOCnow</span> = <span class="mxinfo" id="T6:U670"><span class="mxinfo" id="T6:U671"><span class="mxinfo" id="T6:U672">max(<span class="var type1" id="S55T6U831">MOCnow</span>, <span class="mxinfo" id="T6:U674">0</span>)</span> * <span class="var type1" id="S29T6U833">MOCfactor</span></span> + <span class="mxinfo" id="T6:U676">0.000000001</span></span></span>; <span class="comment">%the tiny offset is due to a crummy Embedded Matlab bug (This caused much misery)!</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',229);">229</a></span><span class="line">    <span class="mxinfo" id="T6:U677"><span class="var type1" id="S55T6U837">MOCnow</span> = <span class="mxinfo" id="T6:U679"><span class="mxinfo" id="T6:U680">10</span>.^(<span class="mxinfo" id="T6:U681"><span class="mxinfo" id="T6:U682">-<span class="var type1" id="S55T6U843">MOCnow</span></span>/<span class="mxinfo" id="T6:U684">20</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',230);">230</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',231);">231</a></span><span class="line">    <span class="mxinfo" id="T52:U685"><span class="mxinfo" id="T52:U686"><span class="var type1" id="S17T2U848">MOCcontrol</span>(<span class="var type1" id="S54T31U849">filterCount</span>, <span class="mxinfo" id="T43:U689"><span class="mxinfo" id="T6:U690">1</span>:<span class="var type1" id="S24T6U852">numSamples</span></span>)</span> = <span class="var type1" id="S55T6U853">MOCnow</span></span>; <span class="comment">%Replace the shortened version    </span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',232);">232</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',233);">233</a></span><span class="line">    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',234);">234</a></span><span class="line">    <span class="comment">% SOme calculations for the GUI monitoring</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',235);">235</a></span><span class="line">    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',236);">236</a></span><span class="line">    <span class="mxinfo" id="T6:U693"><span class="mxinfo" id="T6:U694"><span class="var type1" id="S8T3U857">MOCend</span>(<span class="var type1" id="S54T31U858">filterCount</span>)</span> = <span class="mxinfo" id="T6:U697"><span class="var type1" id="S17T2U860">MOCcontrol</span>(<span class="var type1" id="S54T31U861">filterCount</span>, <span class="var type1" id="S24T6U862">numSamples</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',237);">237</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',238);">238</a></span><span class="line">    <span class="mxinfo" id="T6:U701"><span class="mxinfo" id="T6:U702"><span class="var type1" id="S10T3U866">peakOPL</span>(<span class="var type1" id="S54T31U867">filterCount</span>)</span> = <span class="mxinfo" id="T6:U705"><span class="mxinfo" id="T6:U706">20</span>*<span class="mxinfo" id="T6:U707">log10( <span class="mxinfo" id="T6:U708"><span class="mxinfo" id="T6:U709">max(<span class="mxinfo" id="T44:U710">abs(<span class="var type1" id="S43T44U877">yL</span>)</span>)</span> /<span class="mxinfo" id="T6:U712">2e-5</span></span> )</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',239);">239</a></span><span class="line">    <span class="mxinfo" id="T6:U713"><span class="mxinfo" id="T6:U714"><span class="var type1" id="S14T3U882">peakOPR</span>(<span class="var type1" id="S54T31U883">filterCount</span>)</span> = <span class="mxinfo" id="T6:U717"><span class="mxinfo" id="T6:U718">20</span>*<span class="mxinfo" id="T6:U719">log10( <span class="mxinfo" id="T6:U720"><span class="mxinfo" id="T6:U721">max(<span class="mxinfo" id="T44:U722">abs(<span class="var type1" id="S45T44U893">yR</span>)</span>)</span> /<span class="mxinfo" id="T6:U724">2e-5</span></span> )</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',240);">240</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',241);">241</a></span><span class="line"><span class="comment">%     rmsOPL(filterCount) = 20*log10( sqrt(mean(yL.^2)) /2e-5  ); </span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',242);">242</a></span><span class="line"><span class="comment">%     rmsOPR(filterCount) = 20*log10( sqrt(mean(yR.^2)) /2e-5 ); </span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',243);">243</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',244);">244</a></span><span class="line">    <span class="mxinfo" id="T6:U725"><span class="mxinfo" id="T6:U726"><span class="var type1" id="S12T3U898">rmsOPL</span>(<span class="var type1" id="S54T31U899">filterCount</span>)</span> = <span class="mxinfo" id="T6:U729"><span class="var type1" id="S72T44U901">yLdB</span>(<span class="mxinfo" id="T6:U731">end</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',245);">245</a></span><span class="line">    <span class="mxinfo" id="T6:U732"><span class="mxinfo" id="T6:U733"><span class="var type1" id="S16T3U907">rmsOPR</span>(<span class="var type1" id="S54T31U908">filterCount</span>)</span> = <span class="mxinfo" id="T6:U736"><span class="var type1" id="S73T44U910">yRdB</span>(<span class="mxinfo" id="T6:U738">end</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',246);">246</a></span><span class="line"><span class="comment">%     rmsOPL(filterCount) = 20*log10( abs(yL(end)) /2e-5 ); </span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',247);">247</a></span><span class="line"><span class="comment">%     rmsOPR(filterCount) = 20*log10( abs(yR(end)) /2e-5 ); </span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',248);">248</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',249);">249</a></span><span class="line">    <span class="mxinfo" id="T52:U739"><span class="mxinfo" id="T52:U740"><span class="var type1" id="S2T4U916">frameBufferL</span>(<span class="mxinfo" id="T43:U742"><span class="mxinfo" id="T6:U743">1</span>:<span class="var type1" id="S24T6U919">numSamples</span></span>)</span> = <span class="mxinfo" id="T43:U745"><span class="var type1" id="S2T4U922">frameBufferL</span>(<span class="mxinfo" id="T43:U747"><span class="mxinfo" id="T6:U748">1</span>:<span class="var type1" id="S24T6U925">numSamples</span></span>)</span> + <span class="mxinfo" id="T44:U750"><span class="var type1" id="S43T44U927">yL</span>*<span class="mxinfo" id="T6:U752"><span class="var type1" id="S30T37U929">mainGain</span>(<span class="var type1" id="S54T31U930">filterCount</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',250);">250</a></span><span class="line">    <span class="mxinfo" id="T52:U755"><span class="mxinfo" id="T52:U756"><span class="var type1" id="S3T4U934">frameBufferR</span>(<span class="mxinfo" id="T43:U758"><span class="mxinfo" id="T6:U759">1</span>:<span class="var type1" id="S24T6U937">numSamples</span></span>)</span> = <span class="mxinfo" id="T43:U761"><span class="var type1" id="S3T4U940">frameBufferR</span>(<span class="mxinfo" id="T43:U763"><span class="mxinfo" id="T6:U764">1</span>:<span class="var type1" id="S24T6U943">numSamples</span></span>)</span> + <span class="mxinfo" id="T44:U766"><span class="var type1" id="S45T44U945">yR</span>*<span class="mxinfo" id="T6:U768"><span class="var type1" id="S30T37U947">mainGain</span>(<span class="var type1" id="S54T31U948">filterCount</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',251);">251</a></span><span class="line"><span class="keyword">end</span>  <span class="comment">% BF channel</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',252);">252</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',253);">253</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',254);">254</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',255);">255</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameFFT.m',256);">256</a></span><span class="line"><span class="comment">%nick modified broken stick function</span></span></span>
</pre>
