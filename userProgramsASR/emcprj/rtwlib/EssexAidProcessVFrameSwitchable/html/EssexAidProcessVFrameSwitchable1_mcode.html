<pre class="code">
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',1);">  1</a></span><span class="line"><span class="comment">%#eml</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',2);">  2</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type0" id="S2T0U3">frameBufferL</span>, <span class="var type0" id="S3T0U4">frameBufferR</span>, <span class="var type0" id="S4T0U5">filterStatesL</span>, <span class="var type0" id="S5T0U6">filterStatesR</span>,  <span class="var type0" id="S6T0U7">ARampL</span>, <span class="var type0" id="S7T0U8">ARampR</span>, <span class="var type0" id="S8T0U9">MOCend</span>, <span class="var type0" id="S9T0U10">peakIPL</span>, <span class="var type0" id="S10T0U11">peakOPL</span>, <span class="var type0" id="S11T0U12">rmsIPL</span>, <span class="var type0" id="S12T0U13">rmsOPL</span>, <span class="var type0" id="S13T0U14">peakIPR</span>, <span class="var type0" id="S14T0U15">peakOPR</span>, <span class="var type0" id="S15T0U16">rmsIPR</span>, <span class="var type0" id="S16T0U17">rmsOPR</span>, <span class="var type0" id="S17T0U18">MOCcontrol</span> ] =<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',3);">  3</a></span><span class="line">    <span class="message error" id="M1F1C">EssexAidProcessVFrameSwitchable</span>( <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',4);">  4</a></span><span class="line">    <span class="var type0" id="S2T0U21">frameBufferL</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',5);">  5</a></span><span class="line">    <span class="var type0" id="S3T0U22">frameBufferR</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',6);">  6</a></span><span class="line">    <span class="var type0" id="S4T0U23">filterStatesL</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',7);">  7</a></span><span class="line">    <span class="var type0" id="S5T0U24">filterStatesR</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',8);">  8</a></span><span class="line">    <span class="var type0" id="S18T0U25">filterCoeffs</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',9);">  9</a></span><span class="line">    <span class="var type0" id="S19T0U26">numChannels</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',10);"> 10</a></span><span class="line">    <span class="var type0" id="S20T0U27">numSamples</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',11);"> 11</a></span><span class="line">    <span class="var type0" id="S6T0U28">ARampL</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',12);"> 12</a></span><span class="line">    <span class="var type0" id="S7T0U29">ARampR</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',13);"> 13</a></span><span class="line">    <span class="var type0" id="S21T0U30">ARthresholdPa</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',14);"> 14</a></span><span class="line">    <span class="var type0" id="S22T0U31">filterOrder</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',15);"> 15</a></span><span class="line">    <span class="var type0" id="S23T0U32">DRNLb</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',16);"> 16</a></span><span class="line">    <span class="var type0" id="S24T0U33">DRNLc</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',17);"> 17</a></span><span class="line">    <span class="var type0" id="S25T0U34">MOCthreshold_dBOP</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',18);"> 18</a></span><span class="line">    <span class="var type0" id="S26T0U35">MOCfactor</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',19);"> 19</a></span><span class="line">    <span class="var type0" id="S9T0U36">peakIPL</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',20);"> 20</a></span><span class="line">    <span class="var type0" id="S10T0U37">peakOPL</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',21);"> 21</a></span><span class="line">    <span class="var type0" id="S11T0U38">rmsIPL</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',22);"> 22</a></span><span class="line">    <span class="var type0" id="S12T0U39">rmsOPL</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',23);"> 23</a></span><span class="line">    <span class="var type0" id="S13T0U40">peakIPR</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',24);"> 24</a></span><span class="line">    <span class="var type0" id="S14T0U41">peakOPR</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',25);"> 25</a></span><span class="line">    <span class="var type0" id="S15T0U42">rmsIPR</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',26);"> 26</a></span><span class="line">    <span class="var type0" id="S16T0U43">rmsOPR</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',27);"> 27</a></span><span class="line">    <span class="var type0" id="S8T0U44">MOCend</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',28);"> 28</a></span><span class="line">    <span class="var type0" id="S17T0U45">MOCcontrol</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',29);"> 29</a></span><span class="line">    <span class="var type0" id="S27T0U46">mainGain</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',30);"> 30</a></span><span class="line">    <span class="var type0" id="S28T0U47">useGTF</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',31);"> 31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',32);"> 32</a></span><span class="line"><span class="comment">%ESSEXAIDPROCESSFRAME Essex aid algorithm in frame processing mode</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',33);"> 33</a></span><span class="line"><span class="comment">%   This code will look a bit odd to most Matlab programmers. This is</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',34);"> 34</a></span><span class="line"><span class="comment">%   because the intended target is a C function that will be called on a</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',35);"> 35</a></span><span class="line"><span class="comment">%   sub-millisecond basis. The bizzare enumerations assist the</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',36);"> 36</a></span><span class="line"><span class="comment">%   pass-by-reference functionality that allows this function to fly in</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',37);"> 37</a></span><span class="line"><span class="comment">%   real-time. This function works on a need to know basis, eliminating any</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',38);"> 38</a></span><span class="line"><span class="comment">%   unnecessary data copying or parameter calculation.</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',39);"> 39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',40);"> 40</a></span><span class="line"><span class="comment">% eml.varsize('frameBuffer', 6192);</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',41);"> 41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',42);"> 42</a></span><span class="line"><span class="comment">%Fake enumeration - must be kept up to date with c++ enum</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',43);"> 43</a></span><span class="line"><span class="var type0" id="S29T0U50">enumC_ARb</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',44);"> 44</a></span><span class="line"><span class="var type0" id="S30T0U54">enumC_ARa</span> = 2;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',45);"> 45</a></span><span class="line"><span class="var type0" id="S31T0U58">enumC_MOCb</span> = 4;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',46);"> 46</a></span><span class="line"><span class="var type0" id="S32T0U62">enumC_MOCa</span> = 6;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',47);"> 47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',48);"> 48</a></span><span class="line"><span class="comment">% enumC_BPb1 = 8;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',49);"> 49</a></span><span class="line"><span class="comment">% enumC_BPa1 = 13;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',50);"> 50</a></span><span class="line"><span class="comment">% enumC_BPb2 = 18;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',51);"> 51</a></span><span class="line"><span class="comment">% enumC_BPa2 = 23;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',52);"> 52</a></span><span class="line"><span class="comment">% enumC_BPb3 = 28;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',53);"> 53</a></span><span class="line"><span class="comment">% enumC_BPa3 = 33;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',54);"> 54</a></span><span class="line"><span class="comment">% enumC_BPb4 = 38;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',55);"> 55</a></span><span class="line"><span class="comment">% enumC_BPa4 = 43;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',56);"> 56</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',57);"> 57</a></span><span class="line"><span class="var type0" id="S33T0U66">enumS_AR</span>   = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',58);"> 58</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',59);"> 59</a></span><span class="line"><span class="comment">% enumS_MOC1  = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',60);"> 60</a></span><span class="line"><span class="comment">% enumS_BPin_1_1 = 2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',61);"> 61</a></span><span class="line"><span class="comment">% enumS_BPin_2_1 = 6;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',62);"> 62</a></span><span class="line"><span class="comment">% enumS_BPout_1_1 = 10;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',63);"> 63</a></span><span class="line"><span class="comment">% enumS_BPout_2_1 = 14;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',64);"> 64</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',65);"> 65</a></span><span class="line"><span class="comment">% enumS_MOC2 = 18;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',66);"> 66</a></span><span class="line"><span class="comment">% enumS_BPin_1_2 = 19;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',67);"> 67</a></span><span class="line"><span class="comment">% enumS_BPin_2_2 = 23;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',68);"> 68</a></span><span class="line"><span class="comment">% enumS_BPout_1_2 = 27;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',69);"> 69</a></span><span class="line"><span class="comment">% enumS_BPout_2_2 = 31;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',70);"> 70</a></span><span class="line"><span class="comment">% <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',71);"> 71</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',72);"> 72</a></span><span class="line"><span class="comment">% rmsLev[0] = iunput RMS from AR smoothed response</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',73);"> 73</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',74);"> 74</a></span><span class="line"><span class="comment">%Initial gain</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',75);"> 75</a></span><span class="line"><span class="comment">% frameBuffer(1:numSamples) = frameBuffer(1:numSamples)*ipScalar;</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',76);"> 76</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',77);"> 77</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',78);"> 78</a></span><span class="line"><span class="comment">%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',79);"> 79</a></span><span class="line"><span class="comment">% Place where conversion to velocity once lived</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',80);"> 80</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',81);"> 81</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',82);"> 82</a></span><span class="line"><span class="comment">% tympanic membrane response in meters</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',83);"> 83</a></span><span class="line"><span class="var type0" id="S34T0U70">stapesVelL</span> = <span class="var type0" id="S2T0U72">frameBufferL</span>(1:<span class="var type0" id="S20T0U75">numSamples</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',84);"> 84</a></span><span class="line"><span class="var type0" id="S35T0U78">stapesVelR</span> = <span class="var type0" id="S3T0U80">frameBufferR</span>(1:<span class="var type0" id="S20T0U83">numSamples</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',85);"> 85</a></span><span class="line"><span class="var type0" id="S2T0U87">frameBufferL</span>(1:<span class="var type0" id="S20T0U90">numSamples</span>) = zeros(size(<span class="var type0" id="S2T0U96">frameBufferL</span>(1:<span class="var type0" id="S20T0U99">numSamples</span>)));</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',86);"> 86</a></span><span class="line"><span class="var type0" id="S3T0U103">frameBufferR</span>(1:<span class="var type0" id="S20T0U106">numSamples</span>) = zeros(size(<span class="var type0" id="S2T0U112">frameBufferL</span>(1:<span class="var type0" id="S20T0U115">numSamples</span>)));</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',87);"> 87</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',88);"> 88</a></span><span class="line"><span class="comment">%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',89);"> 89</a></span><span class="line"><span class="comment">% ACOUSTIC REFLEX</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',90);"> 90</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',91);"> 91</a></span><span class="line"><span class="comment">% find  rms of smoothed ip signal</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',92);"> 92</a></span><span class="line"><span class="comment">%  this will be used to trigger the AR reflex</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',93);"> 93</a></span><span class="line">[<span class="var type0" id="S38T0U119">yL</span>,  <span class="var type0" id="S4T0U121">filterStatesL</span>(<span class="var type0" id="S33T0U123">enumS_AR</span>+1)] = filter(<span class="var type0" id="S18T0U128">filterCoeffs</span>(<span class="var type0" id="S29T0U131">enumC_ARb</span>+1:<span class="var type0" id="S29T0U134">enumC_ARb</span>+2), <span class="var type0" id="S18T0U137">filterCoeffs</span>(<span class="var type0" id="S30T0U140">enumC_ARa</span>+1:<span class="var type0" id="S30T0U143">enumC_ARa</span>+2) , <span class="var type0" id="S34T0U146">stapesVelL</span>.^2, <span class="var type0" id="S4T0U149">filterStatesL</span>(<span class="var type0" id="S33T0U151">enumS_AR</span>+1));</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',94);"> 94</a></span><span class="line">[<span class="var type0" id="S40T0U156">yR</span>,  <span class="var type0" id="S5T0U158">filterStatesR</span>(<span class="var type0" id="S33T0U160">enumS_AR</span>+1)] = filter(<span class="var type0" id="S18T0U165">filterCoeffs</span>(<span class="var type0" id="S29T0U168">enumC_ARb</span>+1:<span class="var type0" id="S29T0U171">enumC_ARb</span>+2), <span class="var type0" id="S18T0U174">filterCoeffs</span>(<span class="var type0" id="S30T0U177">enumC_ARa</span>+1:<span class="var type0" id="S30T0U180">enumC_ARa</span>+2) , <span class="var type0" id="S35T0U183">stapesVelR</span>.^2, <span class="var type0" id="S5T0U186">filterStatesR</span>(<span class="var type0" id="S33T0U188">enumS_AR</span>+1));</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',95);"> 95</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',96);"> 96</a></span><span class="line"><span class="comment">% restore Pa scale</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',97);"> 97</a></span><span class="line"><span class="var type0" id="S41T0U192">smoothedARrmsL</span> = sqrt(<span class="var type0" id="S38T0U195">yL</span>);  <span class="comment">%confusing name for parameter - it is a short term RMS.</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',98);"> 98</a></span><span class="line"><span class="var type0" id="S43T0U198">smoothedARrmsR</span> = sqrt(<span class="var type0" id="S40T0U201">yR</span>);  <span class="comment">%confusing name for parameter - it is a short term RMS.</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',99);"> 99</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',100);">100</a></span><span class="line"><span class="comment">% attenuate input (NB cross product used)</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',101);">101</a></span><span class="line"><span class="var type0" id="S34T0U204">stapesVelL</span> = <span class="var type0" id="S34T0U206">stapesVelL</span>./<span class="var type0" id="S6T0U208">ARampL</span>(1:<span class="var type0" id="S20T0U211">numSamples</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',102);">102</a></span><span class="line"><span class="var type0" id="S35T0U214">stapesVelR</span> = <span class="var type0" id="S35T0U216">stapesVelR</span>./<span class="var type0" id="S7T0U218">ARampR</span>(1:<span class="var type0" id="S20T0U221">numSamples</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',103);">103</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',104);">104</a></span><span class="line"><span class="comment">%CALC ARamp FOR NEXT FRAME</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',105);">105</a></span><span class="line"><span class="comment">% compare levels in the previous segment with AR threshold</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',106);">106</a></span><span class="line"><span class="var type0" id="S6T0U225">ARampL</span>(1:<span class="var type0" id="S20T0U228">numSamples</span>) = <span class="var type0" id="S41T0U230">smoothedARrmsL</span>/<span class="var type0" id="S21T0U231">ARthresholdPa</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',107);">107</a></span><span class="line"><span class="var type0" id="S7T0U235">ARampR</span>(1:<span class="var type0" id="S20T0U238">numSamples</span>) = <span class="var type0" id="S43T0U240">smoothedARrmsR</span>/<span class="var type0" id="S21T0U241">ARthresholdPa</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',108);">108</a></span><span class="line"><span class="comment">% all sub-treshold values are set to 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',109);">109</a></span><span class="line"><span class="var type0" id="S6T0U245">ARampL</span>(<span class="var type0" id="S6T0U248">ARampL</span>(1:<span class="var type0" id="S20T0U251">numSamples</span>)&lt;1)=1;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',110);">110</a></span><span class="line"><span class="var type0" id="S7T0U257">ARampR</span>(<span class="var type0" id="S7T0U260">ARampR</span>(1:<span class="var type0" id="S20T0U263">numSamples</span>)&lt;1)=1;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',111);">111</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',112);">112</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',113);">113</a></span><span class="line"><span class="comment">%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',114);">114</a></span><span class="line"><span class="comment">% DRNL</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',115);">115</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',116);">116</a></span><span class="line"><span class="keyword">for</span> <span class="var type0" id="S44T0U268">filterCount</span>=1:<span class="var type0" id="S19T0U271">numChannels</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',117);">117</a></span><span class="line">    <span class="var type0" id="S38T0U274">yL</span>=<span class="var type0" id="S34T0U275">stapesVelL</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',118);">118</a></span><span class="line">    <span class="var type0" id="S40T0U278">yR</span>=<span class="var type0" id="S35T0U279">stapesVelR</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',119);">119</a></span><span class="line">    <span class="var type0" id="S45T0U282">MOCnow</span> = <span class="var type0" id="S17T0U284">MOCcontrol</span>(<span class="var type0" id="S44T0U285">filterCount</span>, 1:<span class="var type0" id="S20T0U288">numSamples</span>); <span class="comment">%syntactic shorthand</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',120);">120</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',121);">121</a></span><span class="line">    <span class="keyword">if</span> <span class="var type0" id="S28T0U291">useGTF</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',122);">122</a></span><span class="line">        assert(<span class="var type0" id="S22T0U296">filterOrder</span> &lt; 5, <span class="string">'filterOrder must be less than 5'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',123);">123</a></span><span class="line">        <span class="keyword">for</span> <span class="var type0" id="S47T0U301">nn</span> = 1:<span class="var type0" id="S22T0U304">filterOrder</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',124);">124</a></span><span class="line">            [<span class="var type0" id="S38T0U308">yL</span>, <span class="var type0" id="S4T0U310">filterStatesL</span>(17*(<span class="var type0" id="S44T0U318">filterCount</span>-1)+3+(<span class="var type0" id="S47T0U324">nn</span>-1)*2   :  17*(<span class="var type0" id="S44T0U333">filterCount</span>-1)+4+(<span class="var type0" id="S47T0U339">nn</span>-1)*2)] =  filter(<span class="var type0" id="S18T0U345">filterCoeffs</span>(10*(<span class="var type0" id="S44T0U352">filterCount</span>-1)+9:10*(<span class="var type0" id="S44T0U360">filterCount</span>-1)+10), <span class="var type0" id="S18T0U364">filterCoeffs</span>(10*(<span class="var type0" id="S44T0U371">filterCount</span>-1)+14:10*(<span class="var type0" id="S44T0U379">filterCount</span>-1)+16), <span class="var type0" id="S38T0U382">yL</span>, <span class="var type0" id="S4T0U384">filterStatesL</span>(17*(<span class="var type0" id="S44T0U392">filterCount</span>-1)+3+(<span class="var type0" id="S47T0U398">nn</span>-1)*2   :  17*(<span class="var type0" id="S44T0U407">filterCount</span>-1)+4+(<span class="var type0" id="S47T0U413">nn</span>-1)*2));</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',125);">125</a></span><span class="line">            [<span class="var type0" id="S40T0U419">yR</span>, <span class="var type0" id="S5T0U421">filterStatesR</span>(17*(<span class="var type0" id="S44T0U429">filterCount</span>-1)+3+(<span class="var type0" id="S47T0U435">nn</span>-1)*2   :  17*(<span class="var type0" id="S44T0U444">filterCount</span>-1)+4+(<span class="var type0" id="S47T0U450">nn</span>-1)*2)] =  filter(<span class="var type0" id="S18T0U456">filterCoeffs</span>(10*(<span class="var type0" id="S44T0U463">filterCount</span>-1)+9:10*(<span class="var type0" id="S44T0U471">filterCount</span>-1)+10), <span class="var type0" id="S18T0U475">filterCoeffs</span>(10*(<span class="var type0" id="S44T0U482">filterCount</span>-1)+14:10*(<span class="var type0" id="S44T0U490">filterCount</span>-1)+16), <span class="var type0" id="S40T0U493">yR</span>, <span class="var type0" id="S5T0U495">filterStatesR</span>(17*(<span class="var type0" id="S44T0U503">filterCount</span>-1)+3+(<span class="var type0" id="S47T0U509">nn</span>-1)*2   :  17*(<span class="var type0" id="S44T0U518">filterCount</span>-1)+4+(<span class="var type0" id="S47T0U524">nn</span>-1)*2));</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',126);">126</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',127);">127</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',128);">128</a></span><span class="line">        assert(<span class="var type0" id="S22T0U533">filterOrder</span> == 2 || <span class="var type0" id="S22T0U536">filterOrder</span> == 4, <span class="string">'filterOrder must be 2 or 4'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',129);">129</a></span><span class="line">        <span class="keyword">for</span> <span class="var type0" id="S47T0U541">nn</span> = 1:<span class="var type0" id="S22T0U545">filterOrder</span>/2;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',130);">130</a></span><span class="line">            [<span class="var type0" id="S38T0U550">yL</span>, <span class="var type0" id="S4T0U552">filterStatesL</span>(17*(<span class="var type0" id="S44T0U560">filterCount</span>-1)+3+(<span class="var type0" id="S47T0U566">nn</span>-1)*4   :  17*(<span class="var type0" id="S44T0U575">filterCount</span>-1)+6+(<span class="var type0" id="S47T0U581">nn</span>-1)*4)] =  filter(<span class="var type0" id="S18T0U587">filterCoeffs</span>(10*(<span class="var type0" id="S44T0U594">filterCount</span>-1)+9:10*(<span class="var type0" id="S44T0U602">filterCount</span>-1)+13), <span class="var type0" id="S18T0U606">filterCoeffs</span>(10*(<span class="var type0" id="S44T0U613">filterCount</span>-1)+14:10*(<span class="var type0" id="S44T0U621">filterCount</span>-1)+18), <span class="var type0" id="S38T0U624">yL</span>, <span class="var type0" id="S4T0U626">filterStatesL</span>(17*(<span class="var type0" id="S44T0U634">filterCount</span>-1)+3+(<span class="var type0" id="S47T0U640">nn</span>-1)*4   :  17*(<span class="var type0" id="S44T0U649">filterCount</span>-1)+6+(<span class="var type0" id="S47T0U655">nn</span>-1)*4));</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',131);">131</a></span><span class="line">            [<span class="var type0" id="S40T0U661">yR</span>, <span class="var type0" id="S5T0U663">filterStatesR</span>(17*(<span class="var type0" id="S44T0U671">filterCount</span>-1)+3+(<span class="var type0" id="S47T0U677">nn</span>-1)*4   :  17*(<span class="var type0" id="S44T0U686">filterCount</span>-1)+6+(<span class="var type0" id="S47T0U692">nn</span>-1)*4)] =  filter(<span class="var type0" id="S18T0U698">filterCoeffs</span>(10*(<span class="var type0" id="S44T0U705">filterCount</span>-1)+9:10*(<span class="var type0" id="S44T0U713">filterCount</span>-1)+13), <span class="var type0" id="S18T0U717">filterCoeffs</span>(10*(<span class="var type0" id="S44T0U724">filterCount</span>-1)+14:10*(<span class="var type0" id="S44T0U732">filterCount</span>-1)+18), <span class="var type0" id="S40T0U735">yR</span>, <span class="var type0" id="S5T0U737">filterStatesR</span>(17*(<span class="var type0" id="S44T0U745">filterCount</span>-1)+3+(<span class="var type0" id="S47T0U751">nn</span>-1)*4   :  17*(<span class="var type0" id="S44T0U760">filterCount</span>-1)+6+(<span class="var type0" id="S47T0U766">nn</span>-1)*4));</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',132);">132</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',133);">133</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',134);">134</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',135);">135</a></span><span class="line">    <span class="var type0" id="S9T0U772">peakIPL</span>(<span class="var type0" id="S44T0U773">filterCount</span>) = 20*log10(   max(abs(<span class="var type0" id="S38T0U783">yL</span>)) /2e-5   ); <span class="comment">%peak in in dB SPL</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',136);">136</a></span><span class="line">    <span class="var type0" id="S13T0U788">peakIPR</span>(<span class="var type0" id="S44T0U789">filterCount</span>) = 20*log10(   max(abs(<span class="var type0" id="S40T0U799">yR</span>)) /2e-5   ); <span class="comment">%peak in in dB SPL</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',137);">137</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',138);">138</a></span><span class="line"><span class="comment">%     rmsIPL(filterCount) = 20*log10(  sqrt(mean(yL.^2)) /2e-5 ); %rms in in dB SPL</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',139);">139</a></span><span class="line"><span class="comment">%     rmsIPR(filterCount) = 20*log10(  sqrt(mean(yR.^2)) /2e-5 ); %rms in in dB SPL</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',140);">140</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',141);">141</a></span><span class="line">    <span class="var type0" id="S11T0U804">rmsIPL</span>(<span class="var type0" id="S44T0U805">filterCount</span>) = 20*log10(  abs(<span class="var type0" id="S38T0U814">yL</span>(end)) /2e-5 ); <span class="comment">%rms in in dB SPL for GUI (bit of a hack, but it is smoothed in GUI)</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',142);">142</a></span><span class="line">    <span class="var type0" id="S15T0U821">rmsIPR</span>(<span class="var type0" id="S44T0U822">filterCount</span>) = 20*log10(  abs(<span class="var type0" id="S40T0U831">yR</span>(end)) /2e-5 ); <span class="comment">%rms in in dB SPL  </span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',143);">143</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',144);">144</a></span><span class="line">    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',145);">145</a></span><span class="line">    <span class="comment">% compression time</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',146);">146</a></span><span class="line">    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',147);">147</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',148);">148</a></span><span class="line">    <span class="comment">% MOC compression first</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',149);">149</a></span><span class="line">    <span class="var type0" id="S38T0U837">yL</span> = <span class="var type0" id="S38T0U839">yL</span>.*<span class="var type0" id="S45T0U840">MOCnow</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',150);">150</a></span><span class="line">    <span class="var type0" id="S40T0U843">yR</span> = <span class="var type0" id="S40T0U845">yR</span>.*<span class="var type0" id="S45T0U846">MOCnow</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',151);">151</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',152);">152</a></span><span class="line">    <span class="comment">% Instantaneous after</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',153);">153</a></span><span class="line">    <span class="var type0" id="S52T0U849">DRNLa</span> = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',154);">154</a></span><span class="line">    <span class="var type0" id="S38T0U853">yL</span> = DRNL_brokenstick_nl (<span class="var type0" id="S38T0U856">yL</span>, <span class="var type0" id="S52T0U857">DRNLa</span>, <span class="var type0" id="S23T0U859">DRNLb</span>(<span class="var type0" id="S44T0U860">filterCount</span>), <span class="var type0" id="S24T0U862">DRNLc</span>(<span class="var type0" id="S44T0U863">filterCount</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',155);">155</a></span><span class="line">    <span class="var type0" id="S40T0U866">yR</span> = DRNL_brokenstick_nl (<span class="var type0" id="S40T0U869">yR</span>, <span class="var type0" id="S52T0U870">DRNLa</span>, <span class="var type0" id="S23T0U872">DRNLb</span>(<span class="var type0" id="S44T0U873">filterCount</span>), <span class="var type0" id="S24T0U875">DRNLc</span>(<span class="var type0" id="S44T0U876">filterCount</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',156);">156</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',157);">157</a></span><span class="line">    <span class="keyword">if</span> <span class="var type0" id="S28T0U879">useGTF</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',158);">158</a></span><span class="line">        <span class="keyword">for</span> <span class="var type0" id="S47T0U882">nn</span> = 1:<span class="var type0" id="S22T0U885">filterOrder</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',159);">159</a></span><span class="line">            [<span class="var type0" id="S38T0U889">yL</span>, <span class="var type0" id="S4T0U891">filterStatesL</span>(17*(<span class="var type0" id="S44T0U899">filterCount</span>-1)+11+(<span class="var type0" id="S47T0U905">nn</span>-1)*2   :  17*(<span class="var type0" id="S44T0U914">filterCount</span>-1)+12+(<span class="var type0" id="S47T0U920">nn</span>-1)*2)] =  filter(<span class="var type0" id="S18T0U926">filterCoeffs</span>(10*(<span class="var type0" id="S44T0U933">filterCount</span>-1)+9:10*(<span class="var type0" id="S44T0U941">filterCount</span>-1)+10), <span class="var type0" id="S18T0U945">filterCoeffs</span>(10*(<span class="var type0" id="S44T0U952">filterCount</span>-1)+14:10*(<span class="var type0" id="S44T0U960">filterCount</span>-1)+16), <span class="var type0" id="S38T0U963">yL</span>, <span class="var type0" id="S4T0U965">filterStatesL</span>(17*(<span class="var type0" id="S44T0U973">filterCount</span>-1)+11+(<span class="var type0" id="S47T0U979">nn</span>-1)*2   :  17*(<span class="var type0" id="S44T0U988">filterCount</span>-1)+12+(<span class="var type0" id="S47T0U994">nn</span>-1)*2));</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',160);">160</a></span><span class="line">            [<span class="var type0" id="S40T0U1000">yR</span>, <span class="var type0" id="S5T0U1002">filterStatesR</span>(17*(<span class="var type0" id="S44T0U1010">filterCount</span>-1)+11+(<span class="var type0" id="S47T0U1016">nn</span>-1)*2   :  17*(<span class="var type0" id="S44T0U1025">filterCount</span>-1)+12+(<span class="var type0" id="S47T0U1031">nn</span>-1)*2)] =  filter(<span class="var type0" id="S18T0U1037">filterCoeffs</span>(10*(<span class="var type0" id="S44T0U1044">filterCount</span>-1)+9:10*(<span class="var type0" id="S44T0U1052">filterCount</span>-1)+10), <span class="var type0" id="S18T0U1056">filterCoeffs</span>(10*(<span class="var type0" id="S44T0U1063">filterCount</span>-1)+14:10*(<span class="var type0" id="S44T0U1071">filterCount</span>-1)+16), <span class="var type0" id="S40T0U1074">yR</span>, <span class="var type0" id="S5T0U1076">filterStatesR</span>(17*(<span class="var type0" id="S44T0U1084">filterCount</span>-1)+11+(<span class="var type0" id="S47T0U1090">nn</span>-1)*2   :  17*(<span class="var type0" id="S44T0U1099">filterCount</span>-1)+12+(<span class="var type0" id="S47T0U1105">nn</span>-1)*2));</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',161);">161</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',162);">162</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',163);">163</a></span><span class="line">        <span class="keyword">for</span> <span class="var type0" id="S47T0U1111">nn</span> = 1:<span class="var type0" id="S22T0U1115">filterOrder</span>/2;</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',164);">164</a></span><span class="line">            [<span class="var type0" id="S38T0U1120">yL</span>, <span class="var type0" id="S4T0U1122">filterStatesL</span>(17*(<span class="var type0" id="S44T0U1130">filterCount</span>-1)+11+(<span class="var type0" id="S47T0U1136">nn</span>-1)*4   :  17*(<span class="var type0" id="S44T0U1145">filterCount</span>-1)+14+(<span class="var type0" id="S47T0U1151">nn</span>-1)*4)] =  filter(<span class="var type0" id="S18T0U1157">filterCoeffs</span>(10*(<span class="var type0" id="S44T0U1164">filterCount</span>-1)+9:10*(<span class="var type0" id="S44T0U1172">filterCount</span>-1)+13), <span class="var type0" id="S18T0U1176">filterCoeffs</span>(10*(<span class="var type0" id="S44T0U1183">filterCount</span>-1)+14:10*(<span class="var type0" id="S44T0U1191">filterCount</span>-1)+18), <span class="var type0" id="S38T0U1194">yL</span>, <span class="var type0" id="S4T0U1196">filterStatesL</span>(17*(<span class="var type0" id="S44T0U1204">filterCount</span>-1)+11+(<span class="var type0" id="S47T0U1210">nn</span>-1)*4   :  17*(<span class="var type0" id="S44T0U1219">filterCount</span>-1)+14+(<span class="var type0" id="S47T0U1225">nn</span>-1)*4));</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',165);">165</a></span><span class="line">            [<span class="var type0" id="S40T0U1231">yR</span>, <span class="var type0" id="S5T0U1233">filterStatesR</span>(17*(<span class="var type0" id="S44T0U1241">filterCount</span>-1)+11+(<span class="var type0" id="S47T0U1247">nn</span>-1)*4   :  17*(<span class="var type0" id="S44T0U1256">filterCount</span>-1)+14+(<span class="var type0" id="S47T0U1262">nn</span>-1)*4)] =  filter(<span class="var type0" id="S18T0U1268">filterCoeffs</span>(10*(<span class="var type0" id="S44T0U1275">filterCount</span>-1)+9:10*(<span class="var type0" id="S44T0U1283">filterCount</span>-1)+13), <span class="var type0" id="S18T0U1287">filterCoeffs</span>(10*(<span class="var type0" id="S44T0U1294">filterCount</span>-1)+14:10*(<span class="var type0" id="S44T0U1302">filterCount</span>-1)+18), <span class="var type0" id="S40T0U1305">yR</span>, <span class="var type0" id="S5T0U1307">filterStatesR</span>(17*(<span class="var type0" id="S44T0U1315">filterCount</span>-1)+11+(<span class="var type0" id="S47T0U1321">nn</span>-1)*4   :  17*(<span class="var type0" id="S44T0U1330">filterCount</span>-1)+14+(<span class="var type0" id="S47T0U1336">nn</span>-1)*4));</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',166);">166</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',167);">167</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',168);">168</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',169);">169</a></span><span class="line">    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',170);">170</a></span><span class="line">    <span class="comment">% Deal with MOC control signal for next frame</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',171);">171</a></span><span class="line">    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',172);">172</a></span><span class="line">    <span class="var type0" id="S54T0U1341">yLdB</span> = 20*log10(  ((2^-16) + abs(<span class="var type0" id="S38T0U1356">yL</span>)) / 20e-6  ); <span class="comment">%dB peak level with 16 bit offset</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',173);">173</a></span><span class="line">    <span class="var type0" id="S55T0U1360">yRdB</span> = 20*log10(  ((2^-16) + abs(<span class="var type0" id="S40T0U1375">yR</span>)) / 20e-6  ); <span class="comment">%dB peak level with 16 bit offset</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',174);">174</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',175);">175</a></span><span class="line">    [<span class="var type0" id="S45T0U1380">MOCnow</span>,  <span class="var type0" id="S4T0U1382">filterStatesL</span>(17*(<span class="var type0" id="S44T0U1388">filterCount</span>-1)+2)]=  filter(<span class="var type0" id="S18T0U1394">filterCoeffs</span>(<span class="var type0" id="S31T0U1397">enumC_MOCb</span>+1:<span class="var type0" id="S31T0U1400">enumC_MOCb</span>+2), <span class="var type0" id="S18T0U1403">filterCoeffs</span>(<span class="var type0" id="S32T0U1406">enumC_MOCa</span>+1:<span class="var type0" id="S32T0U1409">enumC_MOCa</span>+2) , mean([<span class="var type0" id="S54T0U1416">yLdB</span>+6; <span class="var type0" id="S55T0U1420">yRdB</span>+6]), <span class="var type0" id="S4T0U1423">filterStatesL</span>(17*(<span class="var type0" id="S44T0U1429">filterCount</span>-1)+2));    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',176);">176</a></span><span class="line"><span class="comment">%     [MOCnow,  filterStatesL(17*(filterCount-1)+2)]=  filter(filterCoeffs(enumC_MOCb+1:enumC_MOCb+2), filterCoeffs(enumC_MOCa+1:enumC_MOCa+2) , mean([yL.^2; yR.^2]), filterStatesL(17*(filterCount-1)+2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',177);">177</a></span><span class="line"><span class="comment">%     MOCnow = sqrt(MOCnow);    % restore to meaningful scale (meters - not anymore now in velocity mode)</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',178);">178</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',179);">179</a></span><span class="line">    <span class="var type0" id="S45T0U1434">MOCnow</span> = <span class="var type0" id="S45T0U1436">MOCnow</span> - <span class="var type0" id="S25T0U1438">MOCthreshold_dBOP</span>(<span class="var type0" id="S44T0U1439">filterCount</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',180);">180</a></span><span class="line"><span class="comment">%     MOCnow = 20*log10( MOCnow /  20e-6 ) - MOCthreshold_dBOP(filterCount);</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',181);">181</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',182);">182</a></span><span class="line">    <span class="var type0" id="S45T0U1442">MOCnow</span> = max(<span class="var type0" id="S45T0U1447">MOCnow</span>, 0) * <span class="var type0" id="S26T0U1449">MOCfactor</span> + 0.000000001; <span class="comment">%the tiny offset is due to a crummy Embedded Matlab bug (This caused much misery)!</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',183);">183</a></span><span class="line">    <span class="var type0" id="S45T0U1453">MOCnow</span> = 10.^(-<span class="var type0" id="S45T0U1459">MOCnow</span>/20);</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',184);">184</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',185);">185</a></span><span class="line">    <span class="var type0" id="S17T0U1464">MOCcontrol</span>(<span class="var type0" id="S44T0U1465">filterCount</span>, 1:<span class="var type0" id="S20T0U1468">numSamples</span>) = <span class="var type0" id="S45T0U1469">MOCnow</span>; <span class="comment">%Replace the shortened version    </span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',186);">186</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',187);">187</a></span><span class="line">    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',188);">188</a></span><span class="line">    <span class="comment">% SOme calculations for the GUI monitoring</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',189);">189</a></span><span class="line">    <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',190);">190</a></span><span class="line">    <span class="var type0" id="S8T0U1473">MOCend</span>(<span class="var type0" id="S44T0U1474">filterCount</span>) = <span class="var type0" id="S17T0U1476">MOCcontrol</span>(<span class="var type0" id="S44T0U1477">filterCount</span>, <span class="var type0" id="S20T0U1478">numSamples</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',191);">191</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',192);">192</a></span><span class="line">    <span class="var type0" id="S10T0U1482">peakOPL</span>(<span class="var type0" id="S44T0U1483">filterCount</span>) = 20*log10( max(abs(<span class="var type0" id="S38T0U1493">yL</span>)) /2e-5 ); </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',193);">193</a></span><span class="line">    <span class="var type0" id="S14T0U1498">peakOPR</span>(<span class="var type0" id="S44T0U1499">filterCount</span>) = 20*log10( max(abs(<span class="var type0" id="S40T0U1509">yR</span>)) /2e-5 ); </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',194);">194</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',195);">195</a></span><span class="line"><span class="comment">%     rmsOPL(filterCount) = 20*log10( sqrt(mean(yL.^2)) /2e-5  ); </span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',196);">196</a></span><span class="line"><span class="comment">%     rmsOPR(filterCount) = 20*log10( sqrt(mean(yR.^2)) /2e-5 ); </span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',197);">197</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',198);">198</a></span><span class="line">    <span class="var type0" id="S12T0U1514">rmsOPL</span>(<span class="var type0" id="S44T0U1515">filterCount</span>) = <span class="var type0" id="S54T0U1517">yLdB</span>(end); </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',199);">199</a></span><span class="line">    <span class="var type0" id="S16T0U1523">rmsOPR</span>(<span class="var type0" id="S44T0U1524">filterCount</span>) = <span class="var type0" id="S55T0U1526">yRdB</span>(end);</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',200);">200</a></span><span class="line"><span class="comment">%     rmsOPL(filterCount) = 20*log10( abs(yL(end)) /2e-5 ); </span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',201);">201</a></span><span class="line"><span class="comment">%     rmsOPR(filterCount) = 20*log10( abs(yR(end)) /2e-5 ); </span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',202);">202</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',203);">203</a></span><span class="line">    <span class="var type0" id="S2T0U1532">frameBufferL</span>(1:<span class="var type0" id="S20T0U1535">numSamples</span>) = <span class="var type0" id="S2T0U1538">frameBufferL</span>(1:<span class="var type0" id="S20T0U1541">numSamples</span>) + <span class="var type0" id="S38T0U1543">yL</span>*<span class="var type0" id="S27T0U1545">mainGain</span>(<span class="var type0" id="S44T0U1546">filterCount</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',204);">204</a></span><span class="line">    <span class="var type0" id="S3T0U1550">frameBufferR</span>(1:<span class="var type0" id="S20T0U1553">numSamples</span>) = <span class="var type0" id="S3T0U1556">frameBufferR</span>(1:<span class="var type0" id="S20T0U1559">numSamples</span>) + <span class="var type0" id="S40T0U1561">yR</span>*<span class="var type0" id="S27T0U1563">mainGain</span>(<span class="var type0" id="S44T0U1564">filterCount</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',205);">205</a></span><span class="line"><span class="keyword">end</span>  <span class="comment">% BF channel</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',206);">206</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',207);">207</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',208);">208</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',209);">209</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="matlab: emlcprivate('irOpenToLine','C:/Users/nrclark/programming/MAP/userProgramsASR/EssexAidProcessVFrameSwitchable.m',210);">210</a></span><span class="line"><span class="comment">%nick modified broken stick function</span></span></span>
</pre>
